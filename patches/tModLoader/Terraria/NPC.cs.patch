--- src/Terraria\Terraria\NPC.cs
+++ src/tModLoader\Terraria\NPC.cs
@@ -16,11 +_,38 @@
 using Terraria.Localization;
 using Terraria.Utilities;
 using Terraria.World.Generation;
+using Terraria.ModLoader;
 
 namespace Terraria
 {
 	public class NPC : Entity
 	{
+		public ModNPC modNPC
+		{
+			get;
+			internal set;
+		}
+
+		internal GlobalNPC[] globalNPCs = new GlobalNPC[0];
+
+		/// <summary>Gets the global NPC. Use this overload when you dynamically add GlobalNPC manually.</summary>
+		public GlobalNPC GetGlobalNPC(Mod mod, string name)
+		{
+			return NPCLoader.GetGlobalNPC(this, mod, name);
+		}
+
+		/// <summary>Gets the global NPC. Use this overload when you know only 1 instance will ever be added by this particular mod.</summary>
+		public T GetGlobalNPC<T>(Mod mod) where T : GlobalNPC
+		{
+			return (T)GetGlobalNPC(mod, typeof(T).Name);
+		}
+
+		/// <summary>Gets the global NPC. Use this overload when you know only 1 instance will ever be added among all mods. 99% of mods should use this.</summary>
+		public T GetGlobalNPC<T>() where T : GlobalNPC
+		{
+			return (T)NPCLoader.GetGlobalNPC(this, typeof(T));
+		}
+
 		private const int NPC_TARGETS_START = 300;
 		public const int MaxMoonLordCountdown = 3600;
 		public const float nameOverIncrement = 0.025f;
@@ -93,13 +_,13 @@
 		private static int townRangeY = NPC.sHeight;
 		public float npcSlots = 1f;
 		private static bool noSpawnCycle = false;
-		private static int activeTime = 750;
+		public static int activeTime = 750;
 		private static int defaultSpawnRate = 600;
 		private static int defaultMaxSpawns = 5;
 		public bool dontCountMe;
 		public int[] buffType = new int[5];
 		public int[] buffTime = new int[5];
-		public bool[] buffImmune = new bool[206];
+		public bool[] buffImmune = new bool[BuffLoader.BuffCount];
 		public bool midas;
 		public bool ichor;
 		public bool onFire;
@@ -241,6 +_,14 @@
 		public static int[,] cavernMonsterType = new int[2, 3];
 		private static int ignorePlayerInteractions = 0;
 
+		private static LuckBasedRandom rand = new LuckBasedRandom();
+
+		public static int Luck
+		{
+			get { return rand.Luck; }
+			set { rand.Luck = value; }
+		}
+
 		public bool CanTalk
 		{
 			get
@@ -583,7 +_,7 @@
 			for (int i = 0; i < 200; i++)
 			{
 				NPC nPC = Main.npc[i];
-				if (nPC.active && nPC.type >= 0 && nPC.type < 580)
+				if (nPC.active && nPC.type >= 0 && nPC.type < NPCLoader.NPCCount)
 				{
 					NPC.npcsFoundForCheckActive[nPC.type] = true;
 				}
@@ -1686,7 +_,7 @@
 						return "No-Eyed Wiley";
 				}
 			}
-			return "";
+			return NPCLoader.TownNPCName(npcType);
 		}
 
 		public NetworkText GetTypeNetName()
@@ -1894,7 +_,7 @@
 			{
 				return 24;
 			}
-			return -1;
+			return NPCHeadLoader.GetNPCHeadSlot(type);
 		}
 
 		public static int HeadIndexToType(int type)
@@ -1995,7 +_,7 @@
 			{
 				return 550;
 			}
-			return -1;
+			return NPCHeadLoader.GetNPCFromHeadSlot(type);
 		}
 
 		public int GetBossHeadTextureIndex()
@@ -2049,9 +_,12 @@
 			{
 				result = 12;
 			}
+			NPCLoader.BossHeadSlot(this, ref result);
 			return result;
 		}
 
+		//  Decompiled Version. New Patches for vanilla updates should merge here. Make sure to update new version below if new bosses are added.
+		/*
 		public float GetBossHeadRotation()
 		{
 			float result = 0f;
@@ -2095,6 +_,29 @@
 				result = this.rotation;
 			}
 			return result;
+		}
+		*/
+
+		// god bless yorai, vanilla checks 5 types
+		public float GetBossHeadRotation()
+		{
+			float rot = 0;
+			switch (type)
+			{
+				case NPCID.Plantera:
+				case NPCID.DungeonGuardian:
+					rot = rotation;
+					break;
+				case NPCID.SkeletronHead:
+				case NPCID.SkeletronPrime:
+					if (ai[1] == 1 || ai[1] == 2) rot = rotation;
+					break;
+				case NPCID.IceQueen:
+					if (ai[0] == 2) rot = rotation;
+					break;
+			}
+			NPCLoader.BossHeadRotation(this, ref rot);
+			return rot;
 		}
 
 		public SpriteEffects GetBossHeadSpriteEffects()
@@ -2105,6 +_,7 @@
 			{
 				result = SpriteEffects.FlipHorizontally;
 			}
+			NPCLoader.BossHeadSpriteEffects(this, ref result);
 			return result;
 		}
 
@@ -2791,6 +_,17 @@
 			}
 		}
 
+		public void CloneDefaults(int Type)
+		{
+			int originalType = this.type;
+			int originalNetID = this.netID;
+			ModNPC originalModEntity = this.modNPC;
+			this.SetDefaultsKeepPlayerInteraction(Type);
+			this.type = originalType;
+			this.netID = originalNetID;
+			this.modNPC = originalModEntity;
+		}
+
 		public void SetDefaultsKeepPlayerInteraction(int Type)
 		{
 			bool[] array = new bool[this.playerInteraction.Length];
@@ -2812,6 +_,8 @@
 				this.SetDefaultsFromNetId(Type);
 				return;
 			}
+			this.modNPC = null;
+			this.globalNPCs = new GlobalNPC[0];
 			this.waterMovementSpeed = (this.lavaMovementSpeed = 0.5f);
 			this.honeyMovementSpeed = 0.25f;
 			this.altTexture = 0;
@@ -2854,7 +_,11 @@
 				this.buffTime[k] = 0;
 				this.buffType[k] = 0;
 			}
-			for (int l = 0; l < 206; l++)
+			if (this.buffImmune.Length != BuffLoader.BuffCount)
+			{
+				Array.Resize(ref this.buffImmune, BuffLoader.BuffCount);
+			}
+			for (int l = 0; l < this.buffImmune.Length; l++)
 			{
 				this.buffImmune[l] = false;
 			}
@@ -11331,9 +_,10 @@
 				this.scale = 1f;
 				this.rarity = 1;
 			}
+			NPCLoader.SetDefaults(this);
 			if (flag)
 			{
-				for (int num2 = 0; num2 < 206; num2++)
+				for (int num2 = 0; num2 < this.buffImmune.Length; num2++)
 				{
 					this.buffImmune[num2] = true;
 				}
@@ -11494,6 +_,7 @@
 						num4++;
 					}
 				}
+				//patch file: num4, num5
 				for (int j = 1; j < num4; j++)
 				{
 					num5 += num6;
@@ -11721,6 +_,7 @@
 					this.damage = (int)((double)this.damage * 0.75);
 					break;
 			}
+			NPCLoader.ScaleExpertStats(this, num4, num5);
 			this.defDefense = this.defense;
 			this.defDamage = this.damage;
 			this.life = this.lifeMax;
@@ -11938,6 +_,11 @@
 		}
 
 		public void AI()
+		{
+			NPCLoader.NPCAI(this);
+		}
+
+		public void VanillaAI()
 		{
 			if (this.aiStyle == 0)
 			{
@@ -38060,6 +_,7 @@
 		private void AI_007_TownEntities()
 		{
 			int maxValue = 300;
+			//patch file: flag
 			bool flag = Main.raining;
 			if (!Main.dayTime)
 			{
@@ -38139,6 +_,7 @@
 					num += 0.15f;
 					this.defense += 8;
 				}
+				NPCLoader.BuffTownNPC(ref num, ref this.defense);
 			}
 			if (this.type == 142 && Main.netMode != 1 && !Main.xMas)
 			{
@@ -38218,7 +_,7 @@
 			{
 				NPC.savedAngler = true;
 			}
-			if (this.type >= 0 && this.type < 580 && NPCID.Sets.TownCritter[this.type] && this.target == 255)
+			if (this.type >= 0 && NPCID.Sets.TownCritter[this.type] && this.target == 255)
 			{
 				this.TargetClosest(true);
 				if (this.position.X < Main.player[this.target].position.X)
@@ -38404,7 +_,14 @@
 			{
 				for (int m = 0; m < 200; m++)
 				{
-					if (Main.npc[m].active && !Main.npc[m].friendly && Main.npc[m].damage > 0 && Main.npc[m].Distance(base.Center) < num6 && (this.type != 453 || !NPCID.Sets.Skeletons.Contains(Main.npc[m].netID)))
+					if (!Main.npc[m].active) continue;
+					bool? modCanHit = NPCLoader.CanHitNPC(Main.npc[m], this);
+					if (modCanHit.HasValue && !modCanHit.Value)
+					{
+						continue;
+					}
+					bool canHitVal = modCanHit.HasValue && modCanHit.Value;
+					if (Main.npc[m].active && !Main.npc[m].friendly && Main.npc[m].damage > 0 && Main.npc[m].Distance(base.Center) < num6 && (this.type != 453 || !NPCID.Sets.Skeletons.Contains(Main.npc[m].netID) || canHitVal))
 					{
 						flag6 = true;
 						float num12 = Main.npc[m].Center.X - base.Center.X;
@@ -38649,7 +_,7 @@
 					if (this.closeDoor && ((this.position.X + (float)(this.width / 2)) / 16f > (float)(this.doorX + 2) || (this.position.X + (float)(this.width / 2)) / 16f < (float)(this.doorX - 2)))
 					{
 						Tile tileSafely = Framing.GetTileSafely(this.doorX, this.doorY);
-						if (tileSafely.type == 11)
+						if (TileLoader.CloseDoorID(tileSafely) >= 0)
 						{
 							bool flag10 = WorldGen.CloseDoor(this.doorX, this.doorY, false);
 							if (flag10)
@@ -38824,7 +_,7 @@
 						Tile tileSafely3 = Framing.GetTileSafely(num17, num18);
 						Tile tileSafely4 = Framing.GetTileSafely(num17, num18 - 1);
 						Tile tileSafely5 = Framing.GetTileSafely(num17, num18 - 2);
-						if (this.townNPC && tileSafely5.nactive() && (tileSafely5.type == 10 || tileSafely5.type == 388) && (Main.rand.Next(10) == 0 || flag))
+						if (this.townNPC && tileSafely5.nactive() && (TileLoader.OpenDoorID(tileSafely5) >= 0 || tileSafely5.type == 388) && (Main.rand.Next(10) == 0 || flag))
 						{
 							if (Main.netMode != 1)
 							{
@@ -39176,12 +_,17 @@
 					num23 = 589;
 					scaleFactor = 7f;
 					num24 = 22;
+					//patch file: num23, num24, num25, num26, scaleFactor, maxValue2
 					num25 = 1;
 					num26 = 10;
 					maxValue2 = 1;
 					knockBack = 2f;
 					num27 = 10f;
 				}
+				NPCLoader.TownNPCAttackStrength(this, ref num24, ref knockBack);
+				NPCLoader.TownNPCAttackCooldown(this, ref num26, ref maxValue2);
+				NPCLoader.TownNPCAttackProj(this, ref num23, ref num25);
+				NPCLoader.TownNPCAttackProjSpeed(this, ref scaleFactor, ref num27, ref num29);
 				if (Main.expertMode)
 				{
 					num24 = (int)((float)num24 * Main.expertNPCDamage);
@@ -39241,7 +_,7 @@
 				int num34 = 0;
 				int maxValue3 = 0;
 				float knockBack2 = 0f;
-				int num35 = 0;
+				float num35 = 0;
 				bool flag17 = false;
 				float num36 = 0f;
 				if ((float)NPCID.Sets.AttackTime[this.type] == this.ai[1])
@@ -39359,12 +_,14 @@
 				else if (this.type == 228)
 				{
 					num31 = 267;
+					//patch file: num31, num32, num33, scaleFactor2
 					scaleFactor2 = 14f;
 					num32 = 20;
 					num33 = 1;
 					num34 = 10;
 					maxValue3 = 1;
 					knockBack2 = 3f;
+					//patch file: num34, num35, num36, maxValue3, knockBack2
 					num35 = 6;
 					num36 = 0.4f;
 				}
@@ -39471,6 +_,11 @@
 						num36 = 0.1f;
 					}
 				}
+				NPCLoader.TownNPCAttackStrength(this, ref num32, ref knockBack2);
+				NPCLoader.TownNPCAttackCooldown(this, ref num34, ref maxValue3);
+				NPCLoader.TownNPCAttackProj(this, ref num31, ref num33);
+				NPCLoader.TownNPCAttackProjSpeed(this, ref scaleFactor2, ref num35, ref num36);
+				NPCLoader.TownNPCAttackShoot(this, ref flag17);
 				if (Main.expertMode)
 				{
 					num32 = (int)((float)num32 * Main.expertNPCDamage);
@@ -39581,21 +_,25 @@
 				if (this.type == 54)
 				{
 					num41 = 585;
+					//patch file: num41, scaleFactor3
 					scaleFactor3 = 10f;
 					num42 = 16;
 					num43 = 30;
+					//patch file: num42, num43, num44, maxValue4, knockBack3
 					num44 = 20;
 					maxValue4 = 15;
 					knockBack3 = 2f;
 					num48 = 1f;
 				}
 				else if (this.type == 108)
+				//patch file: num48
 				{
 					num41 = 15;
 					scaleFactor3 = 6f;
 					num42 = 18;
 					num43 = 15;
 					num44 = 15;
+					//patch file: num45
 					maxValue4 = 5;
 					knockBack3 = 3f;
 					num45 = 20f;
@@ -39621,6 +_,11 @@
 					maxValue4 = 1;
 					knockBack3 = 3f;
 				}
+				NPCLoader.TownNPCAttackStrength(this, ref num42, ref knockBack3);
+				NPCLoader.TownNPCAttackCooldown(this, ref num44, ref maxValue4);
+				NPCLoader.TownNPCAttackProj(this, ref num41, ref num43);
+				NPCLoader.TownNPCAttackProjSpeed(this, ref scaleFactor3, ref num45, ref num48);
+				NPCLoader.TownNPCAttackMagic(this, ref num47);
 				if (Main.expertMode)
 				{
 					num42 = (int)((float)num42 * Main.expertNPCDamage);
@@ -39745,11 +_,15 @@
 				else if (this.type == 353)
 				{
 					num58 = 10;
+					//patch file: num57, num58, num60, num61
 					num61 = (num60 = 32);
 					num57 = 15;
 					maxValue5 = 8;
 					num59 = 5f;
 				}
+				NPCLoader.TownNPCAttackStrength(this, ref num58, ref num59);
+				NPCLoader.TownNPCAttackCooldown(this, ref num57, ref maxValue5);
+				NPCLoader.TownNPCAttackSwing(this, ref num60, ref num61);
 				if (Main.expertMode)
 				{
 					num58 = (int)((float)num58 * Main.expertNPCDamage);
@@ -43916,7 +_,7 @@
 					Main.tile[num177 - this.direction, num178 + 1] = new Tile();
 				}
 				Main.tile[num177, num178 + 1].halfBrick();
-				if (Main.tile[num177, num178 - 1].nactive() && (Main.tile[num177, num178 - 1].type == 10 || Main.tile[num177, num178 - 1].type == 388) && flag6)
+				if (Main.tile[num177, num178 - 1].nactive() && (TileLoader.IsClosedDoor(Main.tile[num177, num178 - 1]) || Main.tile[num177, num178 - 1].type == 388) && flag6)
 				{
 					this.ai[2] += 1f;
 					this.ai[3] = 0f;
@@ -43965,7 +_,7 @@
 							}
 							else
 							{
-								if (Main.tile[num177, num178 - 1].type == 10)
+								if (TileLoader.OpenDoorID(Main.tile[num177, num178 - 1]) >= 0)
 								{
 									bool flag25 = WorldGen.OpenDoor(num177, num178 - 1, this.direction);
 									if (!flag25)
@@ -45002,7 +_,7 @@
 								bool flag3 = tileSafely.active() && Main.tileSolid[(int)tileSafely.type] && !Main.tileFrameImportant[(int)tileSafely.type];
 								if (flag2 && flag3)
 								{
-									int num38 = WorldGen.KillTile_GetTileDustAmount(true, tileSafely);
+									int num38 = WorldGen.KillTile_GetTileDustAmount(true, tileSafely, i, j);
 									for (int k = 0; k < num38; k++)
 									{
 										Dust dust = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
@@ -46790,7 +_,7 @@
 				Tile tileSafely4 = Framing.GetTileSafely(num54, num55 - 1);
 				Tile tileSafely5 = Framing.GetTileSafely(num54, num55 - 2);
 				Tile tileSafely6 = Framing.GetTileSafely(num54, num55 - 3);
-				if (flag8 && tileSafely4.nactive() && (tileSafely4.type == 10 || tileSafely4.type == 388))
+				if (flag8 && tileSafely4.nactive() && (TileLoader.IsClosedDoor(tileSafely4) || tileSafely4.type == 388))
 				{
 					this.ai[0] += 1f;
 					this.ai[3] = 0f;
@@ -46830,7 +_,7 @@
 							}
 							else
 							{
-								if (tileSafely4.type == 10)
+								if (TileLoader.IsClosedDoor(tileSafely4))
 								{
 									bool flag40 = WorldGen.OpenDoor(num54, num55 - 1, this.direction);
 									if (!flag40)
@@ -49239,7 +_,7 @@
 
 		public bool UsesPartyHat()
 		{
-			return this.frame.Height > 0 && this.townNPC && BirthdayParty.PartyIsUp && this.type != 441 && this.type != 37;
+			return this.frame.Height > 0 && this.townNPC && BirthdayParty.PartyIsUp && this.type != 441 && this.type != 37 && NPCLoader.UsesPartyHat(this);
 		}
 
 		public PartyHatColor GetPartyHatColor()
@@ -49274,6 +_,11 @@
 				}
 				num = Main.npcTexture[this.type].Height / Main.npcFrameCount[this.type];
 			}
+			NPCLoader.FindFrame(this, num);
+		}
+
+		public void VanillaFindFrame(int num)
+		{
 			int num2 = 0;
 			if (this.aiAction == 0)
 			{
@@ -58063,7 +_,11 @@
 					{
 						number2 = 5;
 					}
-					NetMessage.SendData(34, -1, -1, null, number2, (float)x, (float)y, 0f, number, 0, 0);
+					if (Main.tile[x, y].type >= TileID.Count)
+					{
+						number2 = 101;
+					}
+					NetMessage.SendData(34, -1, -1, null, number2, (float)x, (float)y, 0f, number, Main.tile[x, y].type, 0);
 					NetMessage.SendTileSquare(-1, x, y, 3, TileChangeType.None);
 				}
 				int num7 = 475;
@@ -58522,6 +_,10 @@
 				}
 				return;
 				IL_2B1:
+				if (!NPCLoader.CheckActive(this))
+				{
+					return;
+				}
 				if (this.townNPC)
 				{
 					Rectangle rectangle = new Rectangle((int)(this.position.X + (float)(this.width / 2) - (float)NPC.townRangeX), (int)(this.position.Y + (float)(this.height / 2) - (float)NPC.townRangeY), NPC.townRangeX * 2, NPC.townRangeY * 2);
@@ -58731,6 +_,10 @@
 					this.netUpdate = true;
 					return;
 				}
+				if (!NPCLoader.CheckDead(this))
+				{
+					return;
+				}
 				NPC.noSpawnCycle = true;
 				if (this.townNPC && this.type != 37 && this.type != 453)
 				{
@@ -58767,7 +_,10 @@
 				{
 					Main.PlaySound(this.DeathSound, this.position);
 				}
-				if (this.type == 13 || this.type == 14 || this.type == 15)
+				if (NPCLoader.SpecialNPCLoot(this))
+				{
+				}
+				else if (this.type == 13 || this.type == 14 || this.type == 15)
 				{
 					bool flag = true;
 					for (int j = 0; j < 200; j++)
@@ -59471,7 +_,7 @@
 
 		public static void ResetKillCount()
 		{
-			for (int i = 0; i < 580; i++)
+			for (int i = 0; i < NPC.killCount.Length; i++)
 			{
 				NPC.killCount[i] = 0;
 			}
@@ -59501,7 +_,7 @@
 
 		public void NPCLoot()
 		{
-			if (Main.netMode == 1 || this.type >= 580)
+			if (Main.netMode == 1)
 			{
 				return;
 			}
@@ -59579,16 +_,16 @@
 						}
 						NetworkText networkText = NetworkText.FromKey("Game.EnemiesDefeatedAnnouncement", new object[]
 							{
-								NPC.killCount[num3],
-								NetworkText.FromKey(Lang.GetNPCName(num5).Key, new object[0])
+						NPC.killCount[num3],
+						NetworkText.FromKey(Lang.GetNPCName(num5).Key, new object[0])
 							});
 						if (num6 >= 0 && num6 < 255)
 						{
 							networkText = NetworkText.FromKey("Game.EnemiesDefeatedByAnnouncement", new object[]
 								{
-									Main.player[num6].name,
-									NPC.killCount[num3],
-									NetworkText.FromKey(Lang.GetNPCName(num5).Key, new object[0])
+							Main.player[num6].name,
+							NPC.killCount[num3],
+							NetworkText.FromKey(Lang.GetNPCName(num5).Key, new object[0])
 								});
 						}
 						if (Main.netMode == 0)
@@ -59621,7 +_,11 @@
 			{
 				return;
 			}
-			if ((this.type == 170 || this.type == 180 || this.type == 171) && Main.rand.Next(3) == 0)
+			if (!NPCLoader.PreNPCLoot(this))
+			{
+				return;
+			}
+			if ((this.type == 170 || this.type == 180 || this.type == 171) && rand.NextBool(3))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3532, 1, false, 0, false, false);
 			}
@@ -59679,7 +_,7 @@
 				goto IL_4B1;
 			}
 			int maxValue = Main.expertMode ? 150 : 200;
-			if (Main.rand.Next(maxValue) == 0)
+			if (rand.NextBool(maxValue))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3260, 1, false, 0, false, false);
 			}
@@ -59702,11 +_,11 @@
 			if (!Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneDungeon)
 			{
 				bool flag3 = false;
-				if (Main.expertMode && Main.rand.Next(5) == 0)
+				if (Main.expertMode && rand.NextBool(5))
 				{
 					flag3 = true;
 				}
-				else if (Main.rand.Next(5) == 0)
+				else if (rand.NextBool(5))
 				{
 					flag3 = true;
 				}
@@ -59737,40 +_,40 @@
 			if (this.type == 1 && this.ai[1] > 0f)
 			{
 				int num9 = (int)this.ai[1];
-				if (num9 > 0 && num9 < 3930)
+				if (num9 > 0)
 				{
 					int num10 = 1;
 					if (num9 == 8)
 					{
-						num10 = Main.rand.Next(5, 11);
+						num10 = rand.NextInt(5, 11);
 					}
 					else if (num9 == 166)
 					{
-						num10 = Main.rand.Next(2, 7);
+						num10 = rand.NextInt(2, 7);
 					}
 					else if (num9 == 965)
 					{
-						num10 = Main.rand.Next(20, 46);
+						num10 = rand.NextInt(20, 46);
 					}
 					else if ((num9 >= 11 && num9 <= 14) || (num9 >= 699 && num9 <= 702))
 					{
-						num10 = Main.rand.Next(3, 9);
-						if (Main.rand.Next(2) == 0)
+						num10 = rand.NextInt(3, 9);
+						if (rand.NextBool(2))
 						{
 							num10 += 5;
 						}
 					}
 					else if (num9 == 71)
 					{
-						num10 = Main.rand.Next(50, 100);
+						num10 = rand.NextInt(50, 100);
 					}
 					else if (num9 == 72)
 					{
-						num10 = Main.rand.Next(20, 100);
+						num10 = rand.NextInt(20, 100);
 					}
 					else if (num9 == 73)
 					{
-						num10 = Main.rand.Next(1, 3);
+						num10 = rand.NextInt(1, 3);
 					}
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num9, num10, false, 0, false, false);
 				}
@@ -59779,75 +_,75 @@
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 867, 1, false, 0, false, false);
 			}
-			if (this.type == 353 && Main.rand.Next(8) == 0)
+			if (this.type == 353 && rand.NextBool(8))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3352, 1, false, 0, false, false);
 			}
-			if (this.type == 441 && Main.rand.Next(8) == 0)
+			if (this.type == 441 && rand.NextBool(8))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3351, 1, false, 0, false, false);
 			}
-			if (this.type == 227 && Main.rand.Next(10) == 0)
+			if (this.type == 227 && rand.NextBool(10))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3350, 1, false, 0, false, false);
 			}
-			if (this.type == 550 && Main.rand.Next(6) == 0)
+			if (this.type == 550 && rand.NextBool(6))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3821, 1, false, 0, false, false);
 			}
-			if (this.type == 208 && Main.rand.Next(4) == 0)
-			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3548, Main.rand.Next(30, 61), false, 0, false, false);
-			}
-			if (this.type == 207 && Main.rand.Next(8) == 0)
+			if (this.type == 208 && rand.NextBool(4))
+			{
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3548, rand.NextInt(30, 61), false, 0, false, false);
+			}
+			if (this.type == 207 && rand.NextBool(8))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3349, 1, false, 0, false, false);
 			}
 			if (Main.hardMode && this.value > 0f)
 			{
-				if (!NPC.downedMechBoss1 && Main.rand.Next(2500) == 0)
+				if (!NPC.downedMechBoss1 && rand.NextBool(2500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 556, 1, false, 0, false, false);
 				}
-				else if (!NPC.downedMechBoss2 && Main.rand.Next(2500) == 0)
+				else if (!NPC.downedMechBoss2 && rand.NextBool(2500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 544, 1, false, 0, false, false);
 				}
-				else if (!NPC.downedMechBoss3 && Main.rand.Next(2500) == 0)
+				else if (!NPC.downedMechBoss3 && rand.NextBool(2500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 557, 1, false, 0, false, false);
 				}
 			}
 			if (Main.halloween && this.value > 0f && this.value < 500f && this.damage < 40 && this.defense < 20)
 			{
-				if (Main.rand.Next(2000) == 0)
+				if (rand.NextBool(2000))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1825, 1, false, 0, false, false);
 				}
-				else if (Main.rand.Next(2000) == 0)
+				else if (rand.NextBool(2000))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1827, 1, false, 0, false, false);
 				}
 			}
 			if (Main.hardMode && this.value > 0f)
 			{
-				if (Main.rand.Next(2500) == 0 && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneJungle)
+				if (rand.NextBool(2500) && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneJungle)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1533, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(2500) == 0 && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneCorrupt)
+				if (rand.NextBool(2500) && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneCorrupt)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1534, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(2500) == 0 && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneCrimson)
+				if (rand.NextBool(2500) && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneCrimson)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1535, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(2500) == 0 && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneHoly)
+				if (rand.NextBool(2500) && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneHoly)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1536, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(2500) == 0 && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneSnow)
+				if (rand.NextBool(2500) && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].ZoneSnow)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1537, 1, false, 0, false, false);
 				}
@@ -59891,13 +_,13 @@
 						}
 						break;
 					case 564:
-						if (Main.rand.Next(7) == 0)
+						if (rand.NextBool(7))
 						{
 							Item.NewItem(this.position, base.Size, 3864, 1, false, 0, false, false);
 						}
-						if (Main.rand.Next(5) == 0)
-						{
-							if (Main.rand.Next(2) == 0)
+						if (rand.NextBool(5))
+						{
+							if (rand.NextBool(2))
 							{
 								Item.NewItem(this.position, base.Size, 3815, 4, false, 0, false, false);
 							}
@@ -59906,12 +_,12 @@
 								Item.NewItem(this.position, base.Size, 3814, 1, false, 0, false, false);
 							}
 						}
-						if (Main.rand.Next(Main.expertMode ? 2 : 3) == 0)
+						if (rand.NextBool(Main.expertMode ? 2 : 3))
 						{
 							Item.NewItem(this.position, base.Size, (int)Utils.SelectRandom<short>(Main.rand, new short[]
 									{
-										3857,
-										3855
+								3857,
+								3855
 									}), 1, false, 0, false, false);
 						}
 						if (DD2Event.ShouldDropCrystals())
@@ -59920,13 +_,13 @@
 						}
 						break;
 					case 565:
-						if (Main.rand.Next(14) == 0)
+						if (rand.NextBool(14))
 						{
 							Item.NewItem(this.position, base.Size, 3864, 1, false, 0, false, false);
 						}
-						if (Main.rand.Next(10) == 0)
-						{
-							if (Main.rand.Next(2) == 0)
+						if (rand.NextBool(10))
+						{
+							if (rand.NextBool(2))
 							{
 								Item.NewItem(this.position, base.Size, 3815, 4, false, 0, false, false);
 							}
@@ -59935,12 +_,12 @@
 								Item.NewItem(this.position, base.Size, 3814, 1, false, 0, false, false);
 							}
 						}
-						if (Main.rand.Next(6) == 0)
+						if (rand.NextBool(6))
 						{
 							Item.NewItem(this.position, base.Size, (int)Utils.SelectRandom<short>(Main.rand, new short[]
 									{
-										3857,
-										3855
+								3857,
+								3855
 									}), 1, false, 0, false, false);
 						}
 						if (DD2Event.ShouldDropCrystals())
@@ -59957,32 +_,32 @@
 						}
 						break;
 					case 576:
-						if (Main.rand.Next(7) == 0)
+						if (rand.NextBool(7))
 						{
 							Item.NewItem(this.position, base.Size, 3865, 1, false, 0, false, false);
 						}
-						if (Main.rand.Next(Main.expertMode ? 2 : 3) == 0)
+						if (rand.NextBool(Main.expertMode ? 2 : 3))
 						{
 							Item.NewItem(this.position, base.Size, (int)Utils.SelectRandom<short>(Main.rand, new short[]
 									{
-										3809,
-										3811,
-										3810,
-										3812
+								3809,
+								3811,
+								3810,
+								3812
 									}), 1, false, 0, false, false);
 						}
-						if (Main.rand.Next(Main.expertMode ? 2 : 3) == 0)
+						if (rand.NextBool(Main.expertMode ? 2 : 3))
 						{
 							Item.NewItem(this.position, base.Size, (int)Utils.SelectRandom<short>(Main.rand, new short[]
 									{
-										3852,
-										3854,
-										3823,
-										3835,
-										3836
+								3852,
+								3854,
+								3823,
+								3835,
+								3836
 									}), 1, false, 0, false, false);
 						}
-						if (Main.rand.Next(Main.expertMode ? 4 : 5) == 0)
+						if (rand.NextBool(Main.expertMode ? 4 : 5))
 						{
 							Item.NewItem(this.position, base.Size, 3856, 1, false, 0, false, false);
 						}
@@ -59992,32 +_,32 @@
 						}
 						break;
 					case 577:
-						if (Main.rand.Next(14) == 0)
+						if (rand.NextBool(14))
 						{
 							Item.NewItem(this.position, base.Size, 3865, 1, false, 0, false, false);
 						}
-						if (Main.rand.Next(6) == 0)
+						if (rand.NextBool(6))
 						{
 							Item.NewItem(this.position, base.Size, (int)Utils.SelectRandom<short>(Main.rand, new short[]
 									{
-										3809,
-										3811,
-										3810,
-										3812
+								3809,
+								3811,
+								3810,
+								3812
 									}), 1, false, 0, false, false);
 						}
-						if (Main.rand.Next(6) == 0)
+						if (rand.NextBool(6))
 						{
 							Item.NewItem(this.position, base.Size, (int)Utils.SelectRandom<short>(Main.rand, new short[]
 									{
-										3852,
-										3854,
-										3823,
-										3835,
-										3836
+								3852,
+								3854,
+								3823,
+								3835,
+								3836
 									}), 1, false, 0, false, false);
 						}
-						if (Main.rand.Next(10) == 0)
+						if (rand.NextBool(10))
 						{
 							Item.NewItem(this.position, base.Size, 3856, 1, false, 0, false, false);
 						}
@@ -60060,7 +_,7 @@
 				{
 					NPC.downedChristmasSantank = true;
 				}
-				if ((this.type == 344 || this.type == 345 || this.type == 346) && Main.rand.Next(num12) == 0 && num11 >= 15)
+				if ((this.type == 344 || this.type == 345 || this.type == 346) && rand.NextBool(num12) && num11 >= 15)
 				{
 					int num13 = 4;
 					if (num11 == 16)
@@ -60083,11 +_,11 @@
 					{
 						num13 = 2;
 					}
-					if (Main.expertMode && Main.rand.Next(3) == 0)
+					if (Main.expertMode && rand.NextBool(3))
 					{
 						num13--;
 					}
-					if (Main.rand.Next(num13) == 0)
+					if (rand.NextBool(num13))
 					{
 						if (this.type == 344)
 						{
@@ -60103,12 +_,12 @@
 						}
 					}
 				}
-				if (Main.rand.Next(num12) == 0)
+				if (rand.NextBool(num12))
 				{
 					if (this.type == 344)
 					{
 						int num14 = Main.rand.Next(3);
-						if (Main.rand.Next(15) == 0)
+						if (rand.NextBool(15))
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1871, 1, false, -1, false, false);
 						}
@@ -60142,11 +_,11 @@
 					}
 					if (this.type == 345)
 					{
-						if (NPC.waveNumber >= 15 && Main.rand.Next(30) == 0)
+						if (NPC.waveNumber >= 15 && rand.NextBool(30))
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1914, 1, false, 0, false, false);
 						}
-						else if (Main.rand.Next(15) == 0)
+						else if (rand.NextBool(15))
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1959, 1, false, 0, false, false);
 						}
@@ -60171,7 +_,7 @@
 			}
 			if (this.type == 341)
 			{
-				int num17 = Main.rand.Next(5, 11);
+				int num17 = rand.NextInt(5, 11);
 				for (int i = 0; i < num17; i++)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
@@ -60181,15 +_,15 @@
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1869, 1, false, 0, false, false);
 				}
 			}
-			if (this.type >= 338 && this.type <= 340 && Main.rand.Next(5) == 0)
+			if (this.type >= 338 && this.type <= 340 && rand.NextBool(5))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 			}
-			if (this.type >= 338 && this.type <= 340 && Main.rand.Next(200) == 0)
+			if (this.type >= 338 && this.type <= 340 && rand.NextBool(200))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1943 + Main.rand.Next(3), 1, false, 0, false, false);
 			}
-			if (this.type == 342 && Main.rand.Next(3) != 0)
+			if (this.type == 342 && rand.NextBoolInverted(3))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 			}
@@ -60228,13 +_,13 @@
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1856, 1, false, 0, false, false);
 					}
 				}
-				if (Main.rand.Next(num19) == 0)
-				{
-					if (this.type == 315 && Main.rand.Next(20) == 0)
+				if (rand.NextBool(num19))
+				{
+					if (this.type == 315 && rand.NextBool(20))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1857, 1, false, 0, false, false);
 					}
-					if (this.type >= 305 && this.type <= 314 && Main.rand.Next(10) == 0)
+					if (this.type >= 305 && this.type <= 314 && rand.NextBool(10))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, Main.rand.Next(1788, 1791), 1, false, 0, false, false);
 					}
@@ -60255,7 +_,7 @@
 						}
 						if (num20 == 2)
 						{
-							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1836, Main.rand.Next(30, 61), false, 0, false, false);
+							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1836, rand.NextInt(30, 61), false, 0, false, false);
 						}
 						if (num20 == 3)
 						{
@@ -60275,7 +_,7 @@
 						}
 						if (num21 == 0)
 						{
-							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1783, Main.rand.Next(50, 101), false, 0, false, false);
+							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1783, rand.NextInt(50, 101), false, 0, false, false);
 						}
 						if (num21 == 1)
 						{
@@ -60283,7 +_,7 @@
 						}
 						if (num21 == 1)
 						{
-							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1785, Main.rand.Next(25, 51), false, 0, false, false);
+							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1785, rand.NextInt(25, 51), false, 0, false, false);
 						}
 						if (num21 == 2)
 						{
@@ -60310,25 +_,25 @@
 			}
 			if (this.type == 325)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1729, Main.rand.Next(30, 51), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1729, rand.NextInt(30, 51), false, 0, false, false);
 			}
 			if (this.type == 326)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1729, Main.rand.Next(1, 5), false, 0, false, false);
-			}
-			if (this.type >= 305 && this.type <= 314 && Main.rand.Next(4) == 0)
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1729, rand.NextInt(1, 5), false, 0, false, false);
+			}
+			if (this.type >= 305 && this.type <= 314 && rand.NextBool(4))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 			}
-			if (this.type == 326 && Main.rand.Next(6) == 0)
+			if (this.type == 326 && rand.NextBool(6))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 			}
-			if (this.type == 329 && Main.rand.Next(4) == 0)
+			if (this.type == 329 && rand.NextBool(4))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 			}
-			if (this.type == 330 && Main.rand.Next(4) == 0)
+			if (this.type == 330 && rand.NextBool(4))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 			}
@@ -60336,97 +_,97 @@
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 			}
-			if (Main.halloween && this.lifeMax > 1 && this.damage > 0 && !this.friendly && this.type != 121 && this.type != 23 && this.value > 0f && Main.rand.Next(80) == 0)
+			if (Main.halloween && this.lifeMax > 1 && this.damage > 0 && !this.friendly && this.type != 121 && this.type != 23 && this.value > 0f && rand.NextBool(80))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1774, 1, false, 0, false, false);
 			}
-			if (Main.xMas && this.lifeMax > 1 && this.damage > 0 && !this.friendly && this.type != 121 && this.value > 0f && Main.rand.Next(13) == 0)
+			if (Main.xMas && this.lifeMax > 1 && this.damage > 0 && !this.friendly && this.type != 121 && this.value > 0f && rand.NextBool(13))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1869, 1, false, 0, false, false);
 			}
-			if (this.lifeMax > 5 && this.value > 0f && !this.friendly && Main.hardMode && this.position.Y / 16f > (float)(Main.maxTilesY - 200) && Main.rand.Next(50) == 0)
-			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2701, Main.rand.Next(20, 51), false, 0, false, false);
+			if (this.lifeMax > 5 && this.value > 0f && !this.friendly && Main.hardMode && this.position.Y / 16f > (float)(Main.maxTilesY - 200) && rand.NextBool(50))
+			{
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2701, rand.NextInt(20, 51), false, 0, false, false);
 			}
 			if (this.type == 325 || this.type == 327 || this.type == 344 || this.type == 345 || this.type == 346)
 			{
-				int num22 = Main.rand.Next(6) + 6;
+				int num22 = rand.NextInt(6) + 6;
 				for (int j = 0; j < num22; j++)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 				}
 			}
-			if (this.type == 156 && Main.rand.Next(75) == 0)
+			if (this.type == 156 && rand.NextBool(75))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1518, 1, false, 0, false, false);
 			}
-			if (this.type == 243 && Main.rand.Next(3) == 0)
+			if (this.type == 243 && rand.NextBool(3))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1519, 1, false, 0, false, false);
 			}
-			if (this.type >= 269 && this.type <= 280 && Main.rand.Next(450) == 0)
+			if (this.type >= 269 && this.type <= 280 && rand.NextBool(450))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1517, 1, false, 0, false, false);
 			}
-			if ((this.type == 158 || this.type == 159) && Main.rand.Next(40) == 0)
+			if ((this.type == 158 || this.type == 159) && rand.NextBool(40))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1520, 1, false, 0, false, false);
 			}
-			if (this.type == 176 && Main.rand.Next(150) == 0)
+			if (this.type == 176 && rand.NextBool(150))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1521, 1, false, 0, false, false);
 			}
-			if (this.type == 48 && Main.rand.Next(200) == 0)
+			if (this.type == 48 && rand.NextBool(200))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1516, 1, false, 0, false, false);
 			}
-			if (this.type == 205 && Main.rand.Next(2) == 0)
+			if (this.type == 205 && rand.NextBool(2))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1611, 1, false, 0, false, false);
 			}
 			if (this.type == 483 || this.type == 482)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3086, Main.rand.Next(5, 11), false, -1, false, false);
-			}
-			if (!Main.hardMode && Main.rand.Next(100) == 0 && this.HasPlayerTarget && this.lifeMax > 5 && !this.friendly && Main.rand.Next(4) == 0 && this.position.Y / 16f > (float)(Main.maxTilesY - 350) && NPC.downedBoss3)
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3086, rand.NextInt(5, 11), false, -1, false, false);
+			}
+			if (!Main.hardMode && rand.NextBool(100) && this.HasPlayerTarget && this.lifeMax > 5 && !this.friendly && rand.NextBool(4) && this.position.Y / 16f > (float)(Main.maxTilesY - 350) && NPC.downedBoss3)
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3282, 1, false, -1, false, false);
 			}
-			if (Main.hardMode && this.HasPlayerTarget && Main.player[this.target].ZoneSnow && Main.rand.Next(300) == 0 && this.HasPlayerTarget && this.lifeMax > 5 && !this.friendly && this.value > 0f)
+			if (Main.hardMode && this.HasPlayerTarget && Main.player[this.target].ZoneSnow && rand.NextBool(300) && this.HasPlayerTarget && this.lifeMax > 5 && !this.friendly && this.value > 0f)
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3289, 1, false, -1, false, false);
 			}
-			else if (Main.hardMode && Main.rand.Next(200) == 0 && this.HasPlayerTarget && this.lifeMax > 5 && !this.friendly && this.value > 0f)
+			else if (Main.hardMode && rand.NextBool(200) && this.HasPlayerTarget && this.lifeMax > 5 && !this.friendly && this.value > 0f)
 			{
 				if (Main.player[this.target].ZoneJungle && NPC.downedMechBossAny)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3286, 1, false, -1, false, false);
 				}
-				else if (Main.player[this.target].ZoneDungeon && NPC.downedPlantBoss && Main.rand.Next(2) == 0)
+				else if (Main.player[this.target].ZoneDungeon && NPC.downedPlantBoss && rand.NextBool(2))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3291, 1, false, -1, false, false);
 				}
-				else if ((double)(this.position.Y / 16f) > (Main.rockLayer + (double)Main.maxTilesY) / 2.0 && !Main.player[this.target].ZoneDungeon && Main.rand.Next(2) == 0)
+				else if ((double)(this.position.Y / 16f) > (Main.rockLayer + (double)Main.maxTilesY) / 2.0 && !Main.player[this.target].ZoneDungeon && rand.NextBool(2))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3290, 1, false, -1, false, false);
 				}
 			}
 			int num23 = 1;
-			if (Main.expertMode && Main.rand.Next(2) == 0)
+			if (Main.expertMode && rand.NextBool(2))
 			{
 				num23 = 2;
 			}
 			for (int k = 0; k < num23; k++)
 			{
-				if (this.type == 461 && Main.rand.Next(50) == 0)
+				if (this.type == 461 && rand.NextBool(50))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 497, 1, false, -1, false, false);
 				}
-				if ((this.type == 159 || this.type == 158) && Main.rand.Next(35) == 0)
+				if ((this.type == 159 || this.type == 158) && rand.NextBool(35))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 900, 1, false, -1, false, false);
 				}
-				if (this.type == 251 && Main.rand.Next(15) == 0)
+				if (this.type == 251 && rand.NextBool(15))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1311, 1, false, -1, false, false);
 				}
@@ -60434,61 +_,61 @@
 				{
 					if (this.type == 477)
 					{
-						if (Main.rand.Next(20) == 0 && NPC.downedPlantBoss)
+						if (rand.NextBool(20) && NPC.downedPlantBoss)
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2770, 1, false, -1, false, false);
 							k++;
 						}
-						if (Main.rand.Next(4) == 0)
+						if (rand.NextBool(4))
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1570, 1, false, -1, false, false);
 							k++;
 						}
-						else if (Main.rand.Next(3) == 0 && NPC.downedPlantBoss)
+						else if (rand.NextBool(3) && NPC.downedPlantBoss)
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3292, 1, false, -1, false, false);
 							k++;
 						}
 					}
-					if (this.type == 253 && Main.rand.Next(40) == 0)
+					if (this.type == 253 && rand.NextBool(40))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1327, 1, false, -1, false, false);
 					}
 				}
 				if (NPC.downedPlantBoss)
 				{
-					if (this.type == 460 && Main.rand.Next(40) == 0)
+					if (this.type == 460 && rand.NextBool(40))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3098, 1, false, -1, false, false);
 					}
-					if (this.type == 468 && Main.rand.Next(40) == 0)
+					if (this.type == 468 && rand.NextBool(40))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3105, 1, false, -1, false, false);
 					}
-					if (this.type == 466 && Main.rand.Next(40) == 0)
+					if (this.type == 466 && rand.NextBool(40))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3106, 1, false, -1, false, false);
 					}
-					if (this.type == 467 && Main.rand.Next(40) == 0)
+					if (this.type == 467 && rand.NextBool(40))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3249, 1, false, -1, false, false);
 					}
-					if (this.type == 463 && Main.rand.Next(25) == 0)
+					if (this.type == 463 && rand.NextBool(25))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3107, 1, false, -1, false, false);
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3108, Main.rand.Next(100, 201), false, -1, false, false);
-					}
-				}
-			}
-			if (Main.bloodMoon && Main.hardMode && Main.rand.Next(1000) == 0 && this.value > 0f)
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3108, rand.NextInt(100, 201), false, -1, false, false);
+					}
+				}
+			}
+			if (Main.bloodMoon && Main.hardMode && rand.NextBool(1000) && this.value > 0f)
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1314, 1, false, -1, false, false);
 			}
-			if (this.type == 77 && Main.rand.Next(150) == 0)
+			if (this.type == 77 && rand.NextBool(150))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 723, 1, false, -1, false, false);
 			}
-			if (Main.rand.Next(100) == 0 || (Main.expertMode && Main.rand.Next(100) == 0))
+			if (rand.NextBool(100) || (Main.expertMode && rand.NextBool(100)))
 			{
 				int num24 = -1;
 				int num25 = -1;
@@ -60508,7 +_,7 @@
 						switch (num)
 						{
 							case 75:
-								if (Main.rand.Next(2) == 0)
+								if (rand.NextBool(2))
 								{
 									num24 = 889;
 								}
@@ -60516,7 +_,7 @@
 								{
 									num24 = 890;
 								}
-								if (Main.rand.Next(100) != 0)
+								if (rand.NextBoolInverted(100))
 								{
 									goto IL_3174;
 								}
@@ -60544,7 +_,7 @@
 								num24 = 889;
 								goto IL_3174;
 							case 79:
-								if (Main.rand.Next(2) == 0)
+								if (rand.NextBool(2))
 								{
 									num24 = 888;
 								}
@@ -60552,7 +_,7 @@
 								{
 									num24 = 890;
 								}
-								if (Main.rand.Next(100) != 0)
+								if (rand.NextBoolInverted(100))
 								{
 									goto IL_3174;
 								}
@@ -60678,7 +_,7 @@
 				}
 			}
 			int num26 = 1;
-			if (Main.expertMode && Main.rand.Next(2) == 0)
+			if (Main.expertMode && rand.NextBool(2))
 			{
 				num26 = 2;
 			}
@@ -60686,18 +_,18 @@
 			{
 				if (this.type == 290)
 				{
-					if (Main.rand.Next(15) == 0)
+					if (rand.NextBool(15))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1513, 1, false, -1, false, false);
 					}
-					else if (Main.rand.Next(10) == 0)
+					else if (rand.NextBool(10))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 938, 1, false, -1, false, false);
 					}
 				}
-				if (this.type == 287 && Main.rand.Next(6) == 0)
-				{
-					if (Main.rand.Next(2) == 0)
+				if (this.type == 287 && rand.NextBool(6))
+				{
+					if (rand.NextBool(2))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 963, 1, false, -1, false, false);
 					}
@@ -60708,53 +_,53 @@
 				}
 				if (this.type == 291)
 				{
-					if (Main.rand.Next(12) == 0)
+					if (rand.NextBool(12))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1300, 1, false, -1, false, false);
 					}
-					else if (Main.rand.Next(12) == 0)
+					else if (rand.NextBool(12))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1254, 1, false, -1, false, false);
 					}
 				}
 				if (this.type == 292)
 				{
-					if (Main.rand.Next(12) == 0)
+					if (rand.NextBool(12))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1514, 1, false, -1, false, false);
 					}
-					else if (Main.rand.Next(12) == 0)
+					else if (rand.NextBool(12))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 679, 1, false, -1, false, false);
 					}
 				}
-				if (this.type == 293 && Main.rand.Next(18) == 0)
+				if (this.type == 293 && rand.NextBool(18))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 759, 1, false, -1, false, false);
 				}
-				if ((this.type == 281 || this.type == 282) && Main.rand.Next(20) == 0)
+				if ((this.type == 281 || this.type == 282) && rand.NextBool(20))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1446, 1, false, -1, false, false);
 				}
-				if ((this.type == 283 || this.type == 284) && Main.rand.Next(20) == 0)
+				if ((this.type == 283 || this.type == 284) && rand.NextBool(20))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1444, 1, false, -1, false, false);
 				}
-				if ((this.type == 285 || this.type == 286) && Main.rand.Next(20) == 0)
+				if ((this.type == 285 || this.type == 286) && rand.NextBool(20))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1445, 1, false, -1, false, false);
 				}
 				if (this.type >= 269 && this.type <= 280)
 				{
-					if (Main.rand.Next(400) == 0)
+					if (rand.NextBool(400))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1183, 1, false, -1, false, false);
 					}
-					else if (Main.rand.Next(300) == 0)
+					else if (rand.NextBool(300))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1266, 1, false, -1, false, false);
 					}
-					else if (Main.rand.Next(200) == 0)
+					else if (rand.NextBool(200))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 671, 1, false, -1, false, false);
 					}
@@ -60767,20 +_,20 @@
 				{
 					maxValue2 = 9;
 				}
-				if (Main.rand.Next(maxValue2) == 0 && Main.wallDungeon[(int)Main.tile[(int)base.Center.X / 16, (int)base.Center.Y / 16].wall])
+				if (rand.NextBool(maxValue2) && Main.wallDungeon[(int)Main.tile[(int)base.Center.X / 16, (int)base.Center.Y / 16].wall])
 				{
 					NPC.NewNPC((int)base.Center.X, (int)base.Center.Y, 288, 0, 0f, 0f, 0f, 0f, 255);
 				}
 			}
 			if (this.type == 288)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1508, Main.rand.Next(1, 3), false, -1, false, false);
-			}
-			if (this.type == 156 && Main.rand.Next(30) == 0)
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1508, rand.NextInt(1, 3), false, -1, false, false);
+			}
+			if (this.type == 156 && rand.NextBool(30))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 683, 1, false, -1, false, false);
 			}
-			if ((this.type == 195 || this.type == 196) && (Main.expertMode || Main.rand.Next(2) == 0))
+			if ((this.type == 195 || this.type == 196) && (Main.expertMode || rand.NextBool(2)))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3102, 1, false, -1, false, false);
 			}
@@ -60792,7 +_,7 @@
 				}
 				else
 				{
-					if (Main.rand.Next(7) == 0)
+					if (rand.NextBool(7))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2110, 1, false, -1, false, false);
 					}
@@ -60800,7 +_,7 @@
 					if (num27 == 0)
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1258, 1, false, -1, false, false);
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1261, Main.rand.Next(60, 100), false, 0, false, false);
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1261, rand.NextInt(60, 100), false, 0, false, false);
 					}
 					else if (num27 == 1)
 					{
@@ -60830,17 +_,17 @@
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1297, 1, false, -1, false, false);
 					}
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2218, Main.rand.Next(4, 9), false, -1, false, false);
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2218, rand.NextInt(4, 9), false, -1, false, false);
 				}
 				NPC.downedGolemBoss = true;
 			}
-			if (this.type == 471 && (Main.expertMode || Main.rand.Next(2) == 0))
-			{
-				if (Main.rand.Next(3) == 0)
+			if (this.type == 471 && (Main.expertMode || rand.NextBool(2)))
+			{
+				if (rand.NextBool(3))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3052, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(2) == 0)
+				else if (rand.NextBool(2))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3053, 1, false, -1, false, false);
 				}
@@ -60851,7 +_,7 @@
 			}
 			if (this.type == 268)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1332, Main.rand.Next(2, 6), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1332, rand.NextInt(2, 6), false, 0, false, false);
 			}
 			if (this.type == 370)
 			{
@@ -60862,11 +_,11 @@
 				}
 				else
 				{
-					if (Main.rand.Next(7) == 0)
+					if (rand.NextBool(7))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2588, 1, false, -1, false, false);
 					}
-					if (Main.rand.Next(15) == 0)
+					if (rand.NextBool(15))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2609, 1, false, -1, false, false);
 					}
@@ -60901,80 +_,80 @@
 					NetMessage.SendData(7, -1, -1, null, 0, 0f, 0f, 0f, 0, 0, 0);
 				}
 			}
-			if (this.type == 153 && Main.rand.Next(17) == 0)
+			if (this.type == 153 && rand.NextBool(17))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1328, 1, false, -1, false, false);
 			}
-			if (this.type == 120 && Main.rand.Next(500) == 0)
+			if (this.type == 120 && rand.NextBool(500))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1326, 1, false, -1, false, false);
 			}
-			if (this.type == 49 && Main.rand.Next(250) == 0)
+			if (this.type == 49 && rand.NextBool(250))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1325, 1, false, -1, false, false);
 			}
-			if (this.type == 185 && Main.rand.Next(150) == 0)
+			if (this.type == 185 && rand.NextBool(150))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 951, 1, false, -1, false, false);
 			}
-			if (this.type == 44 && Main.rand.Next(50) == 0)
+			if (this.type == 44 && rand.NextBool(50))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1320, 1, false, -1, false, false);
 			}
-			if (this.type == 44 && Main.rand.Next(20) == 0)
+			if (this.type == 44 && rand.NextBool(20))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 88, 1, false, -1, false, false);
 			}
-			if (this.type == 110 && Main.rand.Next(80) == 0)
+			if (this.type == 110 && rand.NextBool(80))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1321, 1, false, -1, false, false);
 			}
-			if (this.type == 60 && Main.rand.Next(150) == 0)
+			if (this.type == 60 && rand.NextBool(150))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1322, 1, false, -1, false, false);
 			}
-			if (this.type == 151 && Main.rand.Next(50) == 0)
+			if (this.type == 151 && rand.NextBool(50))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1322, 1, false, -1, false, false);
 			}
-			if (this.type == 24 && Main.rand.Next(50) == 0)
+			if (this.type == 24 && rand.NextBool(50))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1323, 1, false, -1, false, false);
 			}
-			if (this.type == 109 && Main.rand.Next(30) == 0)
-			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1324, Main.rand.Next(1, 5), false, -1, false, false);
+			if (this.type == 109 && rand.NextBool(30))
+			{
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1324, rand.NextInt(1, 5), false, -1, false, false);
 			}
 			if (this.type == 163 || this.type == 238)
 			{
-				if (Main.rand.Next(40) == 0)
+				if (rand.NextBool(40))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1308, 1, false, -1, false, false);
 				}
 				if (Main.expertMode)
 				{
-					if (Main.rand.Next(3) == 0)
-					{
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2607, Main.rand.Next(2, 4), false, 0, false, false);
-					}
-					else if (Main.rand.Next(2) == 0)
-					{
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2607, Main.rand.Next(1, 4), false, 0, false, false);
+					if (rand.NextBool(3))
+					{
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2607, rand.NextInt(2, 4), false, 0, false, false);
+					}
+					else if (rand.NextBool(2))
+					{
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2607, rand.NextInt(1, 4), false, 0, false, false);
 					}
 					else
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2607, 1, false, 0, false, false);
 					}
 				}
-				else if (Main.rand.Next(4) != 0)
-				{
-					if (Main.rand.Next(3) == 0)
-					{
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2607, Main.rand.Next(1, 4), false, 0, false, false);
-					}
-					else if (Main.rand.Next(2) == 0)
-					{
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2607, Main.rand.Next(1, 3), false, 0, false, false);
+				else if (rand.NextBoolInverted(4))
+				{
+					if (rand.NextBool(3))
+					{
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2607, rand.NextInt(1, 4), false, 0, false, false);
+					}
+					else if (rand.NextBool(2))
+					{
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2607, rand.NextInt(1, 3), false, 0, false, false);
 					}
 					else
 					{
@@ -60982,28 +_,28 @@
 					}
 				}
 			}
-			if (Main.hardMode && (this.type == 197 || this.type == 206 || this.type == 169 || this.type == 154) && Main.rand.Next(180) == 0)
+			if (Main.hardMode && (this.type == 197 || this.type == 206 || this.type == 169 || this.type == 154) && rand.NextBool(180))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1306, 1, false, -1, false, false);
 			}
 			if (this.type == 244)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, Main.rand.Next(1, 6), false, 0, false, false);
-				if (Main.rand.Next(2) == 0)
-				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, Main.rand.Next(1, 6), false, 0, false, false);
-				}
-				if (Main.rand.Next(2) == 0)
-				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, Main.rand.Next(1, 6), false, 0, false, false);
-				}
-				if (Main.rand.Next(2) == 0)
-				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, Main.rand.Next(1, 6), false, 0, false, false);
-				}
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 662, Main.rand.Next(30, 60), false, 0, false, false);
-			}
-			if (this.type == 250 && Main.rand.Next(15) == 0)
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, rand.NextInt(1, 6), false, 0, false, false);
+				if (rand.NextBool(2))
+				{
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, rand.NextInt(1, 6), false, 0, false, false);
+				}
+				if (rand.NextBool(2))
+				{
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, rand.NextInt(1, 6), false, 0, false, false);
+				}
+				if (rand.NextBool(2))
+				{
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, rand.NextInt(1, 6), false, 0, false, false);
+				}
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 662, rand.NextInt(30, 60), false, 0, false, false);
+			}
+			if (this.type == 250 && rand.NextBool(15))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1244, 1, false, -1, false, false);
 			}
@@ -61012,15 +_,15 @@
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 754, 1, false, -1, false, false);
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 755, 1, false, -1, false, false);
 			}
-			if (this.type == 110 && Main.rand.Next(200) == 0)
+			if (this.type == 110 && rand.NextBool(200))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 682, 1, false, -1, false, false);
 			}
-			if (this.type == 154 && Main.rand.Next(100) == 0)
+			if (this.type == 154 && rand.NextBool(100))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1253, 1, false, -1, false, false);
 			}
-			if ((this.type == 169 || this.type == 206) && Main.rand.Next(50) == 0)
+			if ((this.type == 169 || this.type == 206) && rand.NextBool(50))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 726, 1, false, -1, false, false);
 			}
@@ -61028,36 +_,36 @@
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2161, 1, false, -1, false, false);
 			}
-			if (this.type == 480 && Main.rand.Next(50) == 0)
+			if (this.type == 480 && rand.NextBool(50))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3269, 1, false, -1, false, false);
 			}
 			if (this.type == 198 || this.type == 199 || this.type == 226)
 			{
-				if (Main.rand.Next(1000) == 0)
+				if (rand.NextBool(1000))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1172, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(50) == 0)
+				if (rand.NextBool(50))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1293, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(7) == 0)
-				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2766, Main.rand.Next(1, 3), false, -1, false, false);
+				if (rand.NextBool(7))
+				{
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2766, rand.NextInt(1, 3), false, -1, false, false);
 				}
 			}
 			if (this.type == 78 || this.type == 79 || this.type == 80)
 			{
-				if (Main.rand.Next(75) == 0)
+				if (rand.NextBool(75))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 870, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(75) == 0)
+				if (rand.NextBool(75))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 871, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(75) == 0)
+				if (rand.NextBool(75))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 872, 1, false, -1, false, false);
 				}
@@ -61136,14 +_,14 @@
 			}
 			if (this.type == 473 || this.type == 474 || this.type == 475 || this.type == 476)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 499, Main.rand.Next(5, 11), false, -1, false, false);
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 500, Main.rand.Next(5, 16), false, -1, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 499, rand.NextInt(5, 11), false, -1, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 500, rand.NextInt(5, 16), false, -1, false, false);
 			}
 			if (this.type == 85 && this.value > 0f)
 			{
 				if (this.ai[3] == 4f)
 				{
-					if (Main.rand.Next(20) == 0)
+					if (rand.NextBool(20))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1312, 1, false, -1, false, false);
 					}
@@ -61197,203 +_,203 @@
 			{
 				if (Main.expertMode)
 				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 575, Main.rand.Next(5, 11) * 2, false, 0, false, false);
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 575, rand.NextInt(5, 11) * 2, false, 0, false, false);
 				}
 				else
 				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 575, Main.rand.Next(5, 11), false, 0, false, false);
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 575, rand.NextInt(5, 11), false, 0, false, false);
 				}
 			}
 			if (this.type >= 212 && this.type <= 215)
 			{
-				if (Main.rand.Next(8000) == 0)
+				if (rand.NextBool(8000))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 905, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(4000) == 0)
+				if (rand.NextBool(4000))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 855, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(2000) == 0)
+				if (rand.NextBool(2000))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 854, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(2000) == 0)
+				if (rand.NextBool(2000))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2584, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(1000) == 0)
+				if (rand.NextBool(1000))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3033, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(200) == 0)
+				if (rand.NextBool(200))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 672, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(500) == 0)
+				if (rand.NextBool(500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1277, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(500) == 0)
+				if (rand.NextBool(500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1278, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(500) == 0)
+				if (rand.NextBool(500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1279, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(500) == 0)
+				if (rand.NextBool(500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1280, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1704, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1705, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1710, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1716, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1720, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2379, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2389, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2405, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2843, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3885, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2663, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(150) == 0)
-				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3904, Main.rand.Next(6, 11) * 5, false, 0, false, false);
-				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(150))
+				{
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3904, rand.NextInt(6, 11) * 5, false, 0, false, false);
+				}
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3910, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2238, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2133, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2137, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2143, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2147, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2151, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2155, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(500) == 0)
+				if (rand.NextBool(500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3263, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(500) == 0)
+				if (rand.NextBool(500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3264, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(500) == 0)
+				if (rand.NextBool(500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3265, 1, false, 0, false, false);
 				}
 			}
 			else if (this.type == 216)
 			{
-				if (Main.rand.Next(2000) == 0)
+				if (rand.NextBool(2000))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 905, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(1000) == 0)
+				if (rand.NextBool(1000))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 855, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(500) == 0)
+				if (rand.NextBool(500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 854, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(500) == 0)
+				if (rand.NextBool(500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2584, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(250) == 0)
+				if (rand.NextBool(250))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3033, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(50) == 0)
+				if (rand.NextBool(50))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 672, 1, false, -1, false, false);
 				}
 			}
 			else if (this.type == 491)
 			{
-				if (Main.rand.Next(400) == 0)
+				if (rand.NextBool(400))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 905, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(200) == 0)
+				else if (rand.NextBool(200))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 855, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(100) == 0)
+				else if (rand.NextBool(100))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 854, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(100) == 0)
+				else if (rand.NextBool(100))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2584, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(50) == 0)
+				else if (rand.NextBool(50))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3033, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(10) == 0)
+				else if (rand.NextBool(10))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 672, 1, false, -1, false, false);
 				}
 			}
-			if ((this.type == 161 || this.type == 431) && Main.rand.Next(50) == 0)
+			if ((this.type == 161 || this.type == 431) && rand.NextBool(50))
 			{
 				int num34 = Main.rand.Next(3);
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 803 + num34, 1, false, 0, false, false);
@@ -61418,152 +_,152 @@
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1119, 1, false, -1, false, false);
 			}
-			if (this.type == 167 && Main.rand.Next(50) == 0)
+			if (this.type == 167 && rand.NextBool(50))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 879, 1, false, -1, false, false);
 			}
 			if (this.type == 143 || this.type == 144 || this.type == 145)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 593, Main.rand.Next(5, 11), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 593, rand.NextInt(5, 11), false, 0, false, false);
 			}
 			if (this.type == 79)
 			{
-				if (Main.rand.Next(10) == 0)
+				if (rand.NextBool(10))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 527, 1, false, 0, false, false);
 				}
 			}
-			else if (this.type == 80 && Main.rand.Next(10) == 0)
+			else if (this.type == 80 && rand.NextBool(10))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 528, 1, false, 0, false, false);
 			}
-			if (this.type == 524 && Main.rand.Next(10) == 0)
-			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3794, Main.rand.Next(1, 4), false, 0, false, false);
+			if (this.type == 524 && rand.NextBool(10))
+			{
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3794, rand.NextInt(1, 4), false, 0, false, false);
 			}
 			if (this.type == 525)
 			{
-				if (Main.rand.Next(10) == 0)
+				if (rand.NextBool(10))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3794, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(3) == 0)
-				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 522, Main.rand.Next(1, 4), false, 0, false, false);
-				}
-				if (Main.rand.Next(15) == 0)
+				if (rand.NextBool(3))
+				{
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 522, rand.NextInt(1, 4), false, 0, false, false);
+				}
+				if (rand.NextBool(15))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 527, 1, false, 0, false, false);
 				}
 			}
 			if (this.type == 526)
 			{
-				if (Main.rand.Next(10) == 0)
+				if (rand.NextBool(10))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3794, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(3) == 0)
-				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1332, Main.rand.Next(1, 4), false, 0, false, false);
-				}
-				if (Main.rand.Next(15) == 0)
+				if (rand.NextBool(3))
+				{
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1332, rand.NextInt(1, 4), false, 0, false, false);
+				}
+				if (rand.NextBool(15))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 527, 1, false, 0, false, false);
 				}
 			}
 			if (this.type == 527)
 			{
-				if (Main.rand.Next(10) == 0)
+				if (rand.NextBool(10))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3794, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(15) == 0)
+				if (rand.NextBool(15))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 528, 1, false, 0, false, false);
 				}
 			}
 			if (this.type == 532)
 			{
-				if (Main.rand.Next(3) == 0)
+				if (rand.NextBool(3))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3380, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(50) == 0)
+				if (rand.NextBool(50))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3771, 1, false, 0, false, false);
 				}
 			}
 			if (this.type == 528)
 			{
-				if (Main.rand.Next(25) == 0)
+				if (rand.NextBool(25))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2802, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(60) == 0)
+				if (rand.NextBool(60))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3784 + Main.rand.Next(3), 1, false, 0, false, false);
 				}
 			}
 			else if (this.type == 529)
 			{
-				if (Main.rand.Next(25) == 0)
+				if (rand.NextBool(25))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2801, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(40) == 0)
+				if (rand.NextBool(40))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3784 + Main.rand.Next(3), 1, false, 0, false, false);
 				}
 			}
-			if ((this.type == 49 || this.type == 51 || this.type == 150 || this.type == 93) && Main.rand.Next(100) == 0)
+			if ((this.type == 49 || this.type == 51 || this.type == 150 || this.type == 93) && rand.NextBool(100))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 18, 1, false, -1, false, false);
 			}
-			if ((this.type == 16 || this.type == 185 || this.type == 167 || this.type == 197) && Main.rand.Next(50) == 0)
+			if ((this.type == 16 || this.type == 185 || this.type == 167 || this.type == 197) && rand.NextBool(50))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 393, 1, false, -1, false, false);
 			}
-			if (this.type == 58 && Main.rand.Next(75) == 0)
+			if (this.type == 58 && rand.NextBool(75))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 393, 1, false, -1, false, false);
 			}
 			if (this.type >= 494 && this.type <= 506)
 			{
-				if (Main.rand.Next(80) == 0)
+				if (rand.NextBool(80))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 18, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(80) == 0)
+				else if (rand.NextBool(80))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 393, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(25) == 0)
+				else if (rand.NextBool(25))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3285, 1, false, -1, false, false);
 				}
 			}
 			if (this.type == 21 || this.type == 201 || this.type == 202 || this.type == 203 || this.type == 322 || this.type == 323 || this.type == 324 || (this.type >= 449 && this.type <= 452))
 			{
-				if (Main.rand.Next(100) == 0)
+				if (rand.NextBool(100))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 954, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(200) == 0)
+				else if (rand.NextBool(200))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 955, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(200) == 0)
+				else if (rand.NextBool(200))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1166, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(500) == 0)
+				else if (rand.NextBool(500))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1274, 1, false, -1, false, false);
 				}
 			}
 			else if (this.type == 6)
 			{
-				if (Main.rand.Next(175) == 0)
+				if (rand.NextBool(175))
 				{
 					int num35 = Main.rand.Next(3);
 					if (num35 == 0)
@@ -61582,7 +_,7 @@
 			}
 			else if (this.type == 42 || this.type == 43 || (this.type >= 231 && this.type <= 235))
 			{
-				if (Main.rand.Next(100) == 0)
+				if (rand.NextBool(100))
 				{
 					int num36 = Main.rand.Next(3);
 					if (num36 == 0)
@@ -61601,49 +_,49 @@
 			}
 			else if (this.type == 31 || this.type == 32 || this.type == 294 || this.type == 295 || this.type == 296)
 			{
-				if (Main.rand.Next(450) == 0)
+				if (rand.NextBool(450))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 959, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(300) == 0)
+				if (rand.NextBool(300))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1307, 1, false, -1, false, false);
 				}
 			}
-			if ((this.type == 174 || this.type == 179 || this.type == 182 || this.type == 183) && Main.rand.Next(200) == 0)
+			if ((this.type == 174 || this.type == 179 || this.type == 182 || this.type == 183) && rand.NextBool(200))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 996, 1, false, 0, false, false);
 			}
 			if (this.type == 101 || this.type == 98)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 522, Main.rand.Next(2, 6), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 522, rand.NextInt(2, 6), false, 0, false, false);
 			}
 			if (this.type == 86)
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 526, 1, false, 0, false, false);
-				if (Main.rand.Next(100) == 0)
+				if (rand.NextBool(100))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 856, 1, false, 0, false, false);
 				}
 			}
 			if (this.type == 186 || this.type == 432)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 40, Main.rand.Next(1, 10), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 40, rand.NextInt(1, 10), false, 0, false, false);
 			}
 			if (this.type == 225)
 			{
-				if (Main.rand.Next(45) == 0)
+				if (rand.NextBool(45))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1243, 1, false, 0, false, false);
 				}
 				else
 				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, Main.rand.Next(2, 7), false, 0, false, false);
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, rand.NextInt(2, 7), false, 0, false, false);
 				}
 			}
 			if (this.type == 537)
 			{
-				int num37 = Main.rand.Next(1, 3);
+				int num37 = rand.NextInt(1, 3);
 				if (Main.expertMode)
 				{
 					if (this.netID == -7)
@@ -61652,7 +_,7 @@
 					}
 					if (this.netID == -8 || this.netID == -9)
 					{
-						num37 += Main.rand.Next(2);
+						num37 += rand.NextInt(2);
 					}
 				}
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, num37, false, 0, false, false);
@@ -61661,31 +_,31 @@
 				{
 					num38 = (int)((double)num38 * 0.7);
 				}
-				if (Main.rand.Next(num38) == 0)
+				if (rand.NextBool(num38))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1309, 1, false, -1, false, false);
 				}
 			}
-			if (this.type >= 333 && this.type <= 336 && Main.rand.Next(20) == 0)
+			if (this.type >= 333 && this.type <= 336 && rand.NextBool(20))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1906, 1, false, 0, false, false);
 			}
 			if (this.netID == -4)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3111, Main.rand.Next(25, 51), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3111, rand.NextInt(25, 51), false, 0, false, false);
 				int num39 = 100;
 				if (Main.expertMode)
 				{
 					num39 = (int)((double)num39 * 0.7);
 				}
-				if (Main.rand.Next(num39) == 0)
+				if (rand.NextBool(num39))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1309, 1, false, -1, false, false);
 				}
 			}
 			else if (this.type == 1 || this.type == 16 || this.type == 138 || this.type == 141 || this.type == 147 || this.type == 184 || this.type == 187 || this.type == 204 || this.type == 302 || (this.type >= 333 && this.type <= 336) || this.type == 535)
 			{
-				int num40 = Main.rand.Next(1, 3);
+				int num40 = rand.NextInt(1, 3);
 				if (Main.expertMode)
 				{
 					if (this.netID == -7)
@@ -61694,7 +_,7 @@
 					}
 					if (this.netID == -8 || this.netID == -9)
 					{
-						num40 += Main.rand.Next(2);
+						num40 += rand.NextInt(2);
 					}
 				}
 				int num41 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, num40, false, 0, false, false);
@@ -61708,22 +_,22 @@
 				{
 					num42 = (int)((double)num42 * 0.7);
 				}
-				if (Main.rand.Next(num42) == 0)
+				if (rand.NextBool(num42))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1309, 1, false, -1, false, false);
 				}
 			}
 			if (this.type == 75)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 501, Main.rand.Next(1, 4), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 501, rand.NextInt(1, 4), false, 0, false, false);
 			}
 			if (this.type == 81 || this.type == 183)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, Main.rand.Next(2, 5), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, rand.NextInt(2, 5), false, 0, false, false);
 			}
 			if (this.type == 122)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, Main.rand.Next(5, 11), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 23, rand.NextInt(5, 11), false, 0, false, false);
 			}
 			if (this.type == 71)
 			{
@@ -61731,59 +_,59 @@
 			}
 			if (this.type == 2 || this.type == 317 || this.type == 318 || this.type == 190 || this.type == 191 || this.type == 192 || this.type == 193 || this.type == 194 || this.type == 133)
 			{
-				if (Main.rand.Next(3) == 0)
+				if (rand.NextBool(3))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 38, 1, false, 0, false, false);
 				}
-				else if (Main.rand.Next(100) == 0)
+				else if (rand.NextBool(100))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 236, 1, false, 0, false, false);
 				}
 			}
-			if (this.type == 104 && Main.rand.Next(60) == 0)
+			if (this.type == 104 && rand.NextBool(60))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 485, 1, false, -1, false, false);
 			}
 			if (this.type == 58)
 			{
-				if (Main.rand.Next(250) == 0)
+				if (rand.NextBool(250))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 263, 1, false, 0, false, false);
 				}
-				else if (Main.rand.Next(30) == 0)
+				else if (rand.NextBool(30))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 118, 1, false, 0, false, false);
 				}
 			}
-			if (this.type == 102 && Main.rand.Next(250) == 0)
+			if (this.type == 102 && rand.NextBool(250))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 263, 1, false, 0, false, false);
 			}
 			if (this.type == 3 || this.type == 331 || this.type == 332 || this.type == 132 || this.type == 161 || this.type == 186 || this.type == 187 || this.type == 188 || this.type == 189 || this.type == 200 || this.type == 223 || this.type == 319 || this.type == 320 || this.type == 321 || (this.type >= 430 && this.type <= 436))
 			{
-				if (Main.rand.Next(50) == 0)
+				if (rand.NextBool(50))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 216, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(250) == 0)
+				if (rand.NextBool(250))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1304, 1, false, -1, false, false);
 				}
 			}
-			if ((this.type == 489 || this.type == 490) && (Main.expertMode || Main.rand.Next(2) == 0))
-			{
-				if (Main.rand.Next(75) == 0)
+			if ((this.type == 489 || this.type == 490) && (Main.expertMode || rand.NextBool(2)))
+			{
+				if (rand.NextBool(75))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3212, 1, false, -1, false, false);
 				}
-				if (Main.rand.Next(100) == 0)
+				if (rand.NextBool(100))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3213, 1, false, -1, false, false);
 				}
 			}
-			if (this.type == 223 && Main.rand.Next(20) == 0)
-			{
-				if (Main.rand.Next(2) == 0)
+			if (this.type == 223 && rand.NextBool(20))
+			{
+				if (rand.NextBool(2))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1135, 1, false, -1, false, false);
 				}
@@ -61796,11 +_,11 @@
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 267, 1, false, 0, false, false);
 			}
-			if ((this.type == 62 || this.type == 66) && Main.rand.Next(35) == 0)
+			if ((this.type == 62 || this.type == 66) && rand.NextBool(35))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 272, 1, false, -1, false, false);
 			}
-			if (this.value > 0f && Main.hardMode && (double)(this.position.Y / 16f) < Main.worldSurface + 10.0 && (base.Center.X / 16f < 380f || base.Center.X / 16f > (float)(Main.maxTilesX - 380)) && Main.rand.Next(100) == 0)
+			if (this.value > 0f && Main.hardMode && (double)(this.position.Y / 16f) < Main.worldSurface + 10.0 && (base.Center.X / 16f < 380f || base.Center.X / 16f > (float)(Main.maxTilesX - 380)) && rand.NextBool(100))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1315, 1, false, 0, false, false);
 			}
@@ -61825,62 +_,62 @@
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2222, 1, false, 0, false, false);
 			}
-			if ((this.type == 69 || this.type == 509 || this.type == 508) && Main.rand.Next(3) == 0)
-			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 323, Main.rand.Next(1, 3), false, 0, false, false);
-			}
-			if (this.type == 508 && Main.rand.Next(50) == 0)
+			if ((this.type == 69 || this.type == 509 || this.type == 508) && rand.NextBool(3))
+			{
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 323, rand.NextInt(1, 3), false, 0, false, false);
+			}
+			if (this.type == 508 && rand.NextBool(50))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3772, 1, false, 0, false, false);
 			}
 			if (this.type == 73)
 			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 362, Main.rand.Next(1, 3), false, 0, false, false);
-			}
-			if ((this.type == 483 || this.type == 482) && Main.rand.Next(30) == 0)
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 362, rand.NextInt(1, 3), false, 0, false, false);
+			}
+			if ((this.type == 483 || this.type == 482) && rand.NextBool(30))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3109, 1, false, 0, false, false);
 			}
-			if ((this.type == 6 || this.type == 94) && Main.rand.Next(3) == 0)
+			if ((this.type == 6 || this.type == 94) && rand.NextBool(3))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 68, 1, false, 0, false, false);
 			}
-			if ((this.type == 181 || this.type == 173 || this.type == 239 || this.type == 182 || this.type == 240) && Main.rand.Next(3) == 0)
+			if ((this.type == 181 || this.type == 173 || this.type == 239 || this.type == 182 || this.type == 240) && rand.NextBool(3))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1330, 1, false, 0, false, false);
 			}
 			if (this.type == 7 || this.type == 8 || this.type == 9)
 			{
-				if (Main.rand.Next(3) == 0)
-				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 68, Main.rand.Next(1, 3), false, 0, false, false);
-				}
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 69, Main.rand.Next(3, 9), false, 0, false, false);
-			}
-			if ((this.type == 10 || this.type == 11 || this.type == 12 || this.type == 95 || this.type == 96 || this.type == 97) && (Main.rand.Next(50) == 0 || (Main.expertMode && Main.rand.Next(50) == 0)))
+				if (rand.NextBool(3))
+				{
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 68, rand.NextInt(1, 3), false, 0, false, false);
+				}
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 69, rand.NextInt(3, 9), false, 0, false, false);
+			}
+			if ((this.type == 10 || this.type == 11 || this.type == 12 || this.type == 95 || this.type == 96 || this.type == 97) && (rand.NextBool(50) || (Main.expertMode && rand.NextBool(50))))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 215, 1, false, 0, false, false);
 			}
-			if ((this.type == 47 || this.type == 464) && Main.rand.Next(75) == 0)
+			if ((this.type == 47 || this.type == 464) && rand.NextBool(75))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 243, 1, false, 0, false, false);
 			}
-			if ((this.type == 168 || this.type == 470) && Main.rand.Next(50) == 0)
+			if ((this.type == 168 || this.type == 470) && rand.NextBool(50))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, (int)Utils.SelectRandom<short>(Main.rand, new short[]
 						{
-							3757,
-							3758,
-							3759
+					3757,
+					3758,
+					3759
 						}), 1, false, 0, false, false);
 			}
 			if (this.type == 533)
 			{
-				if (Main.rand.Next(40) == 0)
+				if (rand.NextBool(40))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3795, 1, false, 0, false, false);
 				}
-				else if (Main.rand.Next(30) == 0)
+				else if (rand.NextBool(30))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3770, 1, false, 0, false, false);
 				}
@@ -61910,11 +_,11 @@
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3858, 1, false, -1, false, false);
 					}
-					if (Main.rand.Next(7) == 0)
+					if (rand.NextBool(7))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3863, 1, false, -1, false, false);
 					}
-					if (Main.rand.Next(4) == 0)
+					if (rand.NextBool(4))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3883, 1, false, -1, false, false);
 					}
@@ -61928,11 +_,11 @@
 				}
 				else
 				{
-					if (Main.rand.Next(7) == 0)
+					if (rand.NextBool(7))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2112, 1, false, -1, false, false);
 					}
-					if (Main.rand.Next(40) == 0 || (Main.expertMode && Main.rand.Next(20) == 0))
+					if (rand.NextBool(40) || (Main.expertMode && rand.NextBool(20)))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1299, 1, false, 0, false, false);
 					}
@@ -61949,26 +_,26 @@
 					{
 						if (WorldGen.crimson)
 						{
-							int stack = Main.rand.Next(20) + 10;
+							int stack = rand.NextInt(20) + 10;
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 880, stack, false, 0, false, false);
-							stack = Main.rand.Next(20) + 10;
+							stack = rand.NextInt(20) + 10;
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 880, stack, false, 0, false, false);
-							stack = Main.rand.Next(20) + 10;
+							stack = rand.NextInt(20) + 10;
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 880, stack, false, 0, false, false);
-							stack = Main.rand.Next(3) + 1;
+							stack = rand.NextInt(3) + 1;
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2171, stack, false, 0, false, false);
 						}
 						else
 						{
-							int stack2 = Main.rand.Next(30) + 20;
+							int stack2 = rand.NextInt(30) + 20;
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 47, stack2, false, 0, false, false);
-							stack2 = Main.rand.Next(20) + 10;
+							stack2 = rand.NextInt(20) + 10;
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 56, stack2, false, 0, false, false);
-							stack2 = Main.rand.Next(20) + 10;
+							stack2 = rand.NextInt(20) + 10;
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 56, stack2, false, 0, false, false);
-							stack2 = Main.rand.Next(20) + 10;
+							stack2 = rand.NextInt(20) + 10;
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 56, stack2, false, 0, false, false);
-							stack2 = Main.rand.Next(3) + 1;
+							stack2 = rand.NextInt(3) + 1;
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 59, stack2, false, 0, false, false);
 						}
 					}
@@ -61982,22 +_,22 @@
 				}
 				else
 				{
-					int stack3 = Main.rand.Next(20, 46);
+					int stack3 = rand.NextInt(20, 46);
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 880, stack3, false, 0, false, false);
-					stack3 = Main.rand.Next(20, 46);
+					stack3 = rand.NextInt(20, 46);
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 880, stack3, false, 0, false, false);
 					if (Main.expertMode)
 					{
-						stack3 = Main.rand.Next(30, 51);
+						stack3 = rand.NextInt(30, 51);
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 880, stack3, false, 0, false, false);
-						stack3 = Main.rand.Next(30, 51);
+						stack3 = rand.NextInt(30, 51);
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 880, stack3, false, 0, false, false);
 					}
-					if (Main.rand.Next(7) == 0)
+					if (rand.NextBool(7))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2104, 1, false, -1, false, false);
 					}
-					if (Main.rand.Next(20) == 0)
+					if (rand.NextBool(20))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3060, 1, false, 0, false, false);
 					}
@@ -62009,33 +_,33 @@
 			}
 			if (this.type == 267 && NPC.AnyNPCs(266))
 			{
-				int num45 = Main.rand.Next(2, 6);
-				if (Main.rand.Next(3) != 0)
+				int num45 = rand.NextInt(2, 6);
+				if (rand.NextBoolInverted(3))
 				{
 					if (Main.expertMode)
 					{
-						num45 += Main.rand.Next(2, 6);
+						num45 += rand.NextInt(2, 6);
 					}
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1329, num45, false, 0, false, false);
 				}
-				if (Main.rand.Next(3) != 0)
-				{
-					num45 = Main.rand.Next(5, 13);
+				if (rand.NextBoolInverted(3))
+				{
+					num45 = rand.NextInt(5, 13);
 					if (Main.expertMode)
 					{
-						num45 += Main.rand.Next(6, 14);
+						num45 += rand.NextInt(6, 14);
 					}
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 880, num45, false, 0, false, false);
 				}
-				if (Main.rand.Next(2) == 0 && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].statLife < Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].statLifeMax2)
+				if (rand.NextBool(2) && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].statLife < Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].statLifeMax2)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 				}
 			}
 			if (this.type == 13 || this.type == 14 || this.type == 15)
 			{
-				int num46 = Main.rand.Next(1, 3);
-				if (Main.rand.Next(2) == 0)
+				int num46 = rand.NextInt(1, 3);
+				if (rand.NextBool(2))
 				{
 					if (Main.expertMode)
 					{
@@ -62043,9 +_,9 @@
 					}
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 86, num46, false, 0, false, false);
 				}
-				if (Main.rand.Next(2) == 0)
-				{
-					num46 = Main.rand.Next(2, 6);
+				if (rand.NextBool(2))
+				{
+					num46 = rand.NextInt(2, 6);
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 56, num46, false, 0, false, false);
 				}
 				if (this.boss)
@@ -62056,32 +_,32 @@
 					}
 					else
 					{
-						num46 = Main.rand.Next(10, 30);
+						num46 = rand.NextInt(10, 30);
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 56, num46, false, 0, false, false);
-						num46 = Main.rand.Next(10, 31);
+						num46 = rand.NextInt(10, 31);
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 56, num46, false, 0, false, false);
 						if (Main.expertMode)
 						{
-							num46 = Main.rand.Next(10, 30);
+							num46 = rand.NextInt(10, 30);
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 56, num46, false, 0, false, false);
-							num46 = Main.rand.Next(10, 31);
+							num46 = rand.NextInt(10, 31);
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 56, num46, false, 0, false, false);
 						}
 						if (Main.expertMode)
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3224, 1, false, 0, false, false);
 						}
-						if (Main.rand.Next(20) == 0)
+						if (rand.NextBool(20))
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 994, 1, false, 0, false, false);
 						}
-						if (Main.rand.Next(7) == 0)
+						if (rand.NextBool(7))
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2111, 1, false, -1, false, false);
 						}
 					}
 				}
-				if (Main.rand.Next(4) == 0 && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].statLife < Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].statLifeMax2)
+				if (rand.NextBool(4) && Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].statLife < Main.player[(int)Player.FindClosest(this.position, this.width, this.height)].statLifeMax2)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 				}
@@ -62094,7 +_,7 @@
 				}
 				else
 				{
-					if (Main.rand.Next(7) == 0)
+					if (rand.NextBool(7))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2108, 1, false, -1, false, false);
 					}
@@ -62146,15 +_,15 @@
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num48, 1, false, -1, false, false);
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1132, 1, false, -1, false, false);
 					}
-					else if (Main.rand.Next(3) == 0)
+					else if (rand.NextBool(3))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1132, 1, false, -1, false, false);
 					}
-					if ((Main.expertMode && Main.rand.Next(15) == 0) || Main.rand.Next(15) == 0)
+					if ((Main.expertMode && rand.NextBool(15)) || rand.NextBool(15))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1170, 1, false, 0, false, false);
 					}
-					if ((Main.expertMode && Main.rand.Next(20) == 0) || Main.rand.Next(20) == 0)
+					if ((Main.expertMode && rand.NextBool(20)) || rand.NextBool(20))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2502, 1, false, 0, false, false);
 					}
@@ -62163,29 +_,29 @@
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1129, 1, false, 0, false, false);
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, Main.rand.Next(842, 845), 1, false, 0, false, false);
 					}
-					else if (Main.rand.Next(3) == 0)
+					else if (rand.NextBool(3))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1129, 1, false, 0, false, false);
 					}
-					else if (Main.rand.Next(2) == 0)
+					else if (rand.NextBool(2))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, Main.rand.Next(842, 845), 1, false, 0, false, false);
 					}
-					if (Main.rand.Next(4) != 0 || Main.expertMode)
-					{
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1130, Main.rand.Next(10, 30), false, 0, false, false);
+					if (rand.NextBoolInverted(4) || Main.expertMode)
+					{
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1130, rand.NextInt(10, 30), false, 0, false, false);
 						if (Main.expertMode)
 						{
-							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1130, Main.rand.Next(10, 30), false, 0, false, false);
+							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1130, rand.NextInt(10, 30), false, 0, false, false);
 						}
 					}
 					if (Main.expertMode)
 					{
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2431, Main.rand.Next(44, 67), false, 0, false, false);
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2431, rand.NextInt(44, 67), false, 0, false, false);
 					}
 					else
 					{
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2431, Main.rand.Next(16, 27), false, 0, false, false);
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2431, rand.NextInt(16, 27), false, 0, false, false);
 					}
 				}
 				NPC.downedQueenBee = true;
@@ -62200,15 +_,15 @@
 				{
 					this.DropBossBags();
 				}
-				else if (Main.rand.Next(7) == 0)
+				else if (rand.NextBool(7))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1281, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(7) == 0)
+				else if (rand.NextBool(7))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1273, 1, false, -1, false, false);
 				}
-				else if (Main.rand.Next(7) == 0)
+				else if (rand.NextBool(7))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1313, 1, false, -1, false, false);
 				}
@@ -62221,7 +_,7 @@
 				}
 				else
 				{
-					if (Main.rand.Next(7) == 0)
+					if (rand.NextBool(7))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2105, 1, false, -1, false, false);
 					}
@@ -62252,7 +_,7 @@
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 434, 1, false, -1, false, false);
 						}
 					}
-					else if (Main.rand.Next(2) == 0)
+					else if (rand.NextBool(2))
 					{
 						int num51 = Main.rand.Next(4);
 						if (num51 == 3)
@@ -62313,7 +_,7 @@
 			if (this.type == 439)
 			{
 				NPC.downedAncientCultist = true;
-				if (Main.rand.Next(7) == 0)
+				if (rand.NextBool(7))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3372, 1, false, -1, false, false);
 				}
@@ -62330,23 +_,23 @@
 				}
 				else
 				{
-					if (Main.rand.Next(7) == 0)
+					if (rand.NextBool(7))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3373, 1, false, -1, false, false);
 					}
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3384, 1, false, -1, false, false);
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3460, Main.rand.Next(70, 91), false, -1, false, false);
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3460, rand.NextInt(70, 91), false, -1, false, false);
 					int num57 = Utils.SelectRandom<int>(Main.rand, new int[]
 						{
-							3063,
-							3389,
-							3065,
-							1553,
-							3546,
-							3541,
-							3570,
-							3571,
-							3569
+					3063,
+					3389,
+					3065,
+					1553,
+					3546,
+					3541,
+					3570,
+					3571,
+					3569
 						});
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num57, 1, false, -1, false, false);
 				}
@@ -62361,7 +_,7 @@
 					case 407:
 					case 409:
 					case 411:
-						if ((this.type != 406 || Main.rand.Next(3) == 0) && NPC.ShieldStrengthTowerStardust > 0)
+						if ((this.type != 406 || rand.NextBool(3)) && NPC.ShieldStrengthTowerStardust > 0)
 						{
 							Projectile.NewProjectile(base.Center.X, base.Center.Y, 0f, 0f, 629, 0, 0f, Main.myPlayer, (float)NPC.FindFirstNPC(493), 0f);
 							goto IL_9D13;
@@ -62395,14 +_,14 @@
 						goto IL_9D13;
 					case 422:
 						{
-							int num58 = Main.rand.Next(25, 41) / 2;
+							int num58 = rand.NextInt(25, 41) / 2;
 							if (Main.expertMode)
 							{
 								num58 = (int)((float)num58 * 1.5f);
 							}
 							for (int num59 = 0; num59 < num58; num59++)
 							{
-								Item.NewItem((int)this.position.X + Main.rand.Next(this.width), (int)this.position.Y + Main.rand.Next(this.height), 2, 2, 3456, Main.rand.Next(1, 4), false, 0, false, false);
+								Item.NewItem((int)this.position.X + Main.rand.Next(this.width), (int)this.position.Y + Main.rand.Next(this.height), 2, 2, 3456, rand.NextInt(1, 4), false, 0, false, false);
 							}
 							NPC.downedTowerVortex = true;
 							NPC.TowerActiveVortex = false;
@@ -62426,14 +_,14 @@
 							{
 								goto IL_9D13;
 							}
-							int num60 = Main.rand.Next(25, 41) / 2;
+							int num60 = rand.NextInt(25, 41) / 2;
 							if (Main.expertMode)
 							{
 								num60 = (int)((float)num60 * 1.5f);
 							}
 							for (int num61 = 0; num61 < num60; num61++)
 							{
-								Item.NewItem((int)this.position.X + Main.rand.Next(this.width), (int)this.position.Y + Main.rand.Next(this.height), 2, 2, 3459, Main.rand.Next(1, 4), false, 0, false, false);
+								Item.NewItem((int)this.position.X + Main.rand.Next(this.width), (int)this.position.Y + Main.rand.Next(this.height), 2, 2, 3459, rand.NextInt(1, 4), false, 0, false, false);
 							}
 							NPC.downedTowerStardust = true;
 							NPC.TowerActiveStardust = false;
@@ -62447,14 +_,14 @@
 			{
 				if (num == 507)
 				{
-					int num62 = Main.rand.Next(25, 41) / 2;
+					int num62 = rand.NextInt(25, 41) / 2;
 					if (Main.expertMode)
 					{
 						num62 = (int)((float)num62 * 1.5f);
 					}
 					for (int num63 = 0; num63 < num62; num63++)
 					{
-						Item.NewItem((int)this.position.X + Main.rand.Next(this.width), (int)this.position.Y + Main.rand.Next(this.height), 2, 2, 3457, Main.rand.Next(1, 4), false, 0, false, false);
+						Item.NewItem((int)this.position.X + Main.rand.Next(this.width), (int)this.position.Y + Main.rand.Next(this.height), 2, 2, 3457, rand.NextInt(1, 4), false, 0, false, false);
 					}
 					NPC.downedTowerNebula = true;
 					NPC.TowerActiveNebula = false;
@@ -62466,14 +_,14 @@
 				{
 					case 517:
 						{
-							int num64 = Main.rand.Next(25, 41) / 2;
+							int num64 = rand.NextInt(25, 41) / 2;
 							if (Main.expertMode)
 							{
 								num64 = (int)((float)num64 * 1.5f);
 							}
 							for (int num65 = 0; num65 < num64; num65++)
 							{
-								Item.NewItem((int)this.position.X + Main.rand.Next(this.width), (int)this.position.Y + Main.rand.Next(this.height), 2, 2, 3458, Main.rand.Next(1, 4), false, 0, false, false);
+								Item.NewItem((int)this.position.X + Main.rand.Next(this.width), (int)this.position.Y + Main.rand.Next(this.height), 2, 2, 3458, rand.NextInt(1, 4), false, 0, false, false);
 							}
 							NPC.downedTowerSolar = true;
 							NPC.TowerActiveSolar = false;
@@ -62514,23 +_,23 @@
 					}
 					break;
 			}
-			if (Main.rand.Next(8) == 0)
-			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2860, Main.rand.Next(8, 21), false, 0, false, false);
+			if (rand.NextBool(8))
+			{
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2860, rand.NextInt(8, 21), false, 0, false, false);
 			}
 			IL_9DA6:
 			num = this.type;
 			if (num == 383 || num == 386 || num == 389)
 			{
-				if (Main.rand.Next(200) == 0)
+				if (rand.NextBool(200))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2806, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(200) == 0)
+				if (rand.NextBool(200))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2807, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(200) == 0)
+				if (rand.NextBool(200))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2808, 1, false, 0, false, false);
 				}
@@ -62552,15 +_,15 @@
 					}
 					break;
 			}
-			if (Main.rand.Next(200) == 0)
+			if (rand.NextBool(200))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2803, 1, false, 0, false, false);
 			}
-			if (Main.rand.Next(200) == 0)
+			if (rand.NextBool(200))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2804, 1, false, 0, false, false);
 			}
-			if (Main.rand.Next(200) == 0)
+			if (rand.NextBool(200))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2805, 1, false, 0, false, false);
 			}
@@ -62569,60 +_,60 @@
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, Utils.SelectRandom<int>(Main.rand, new int[]
 						{
-							2797,
-							2749,
-							2795,
-							2798,
-							2796,
-							2882,
-							2880,
-							2769,
-							2800
+					2797,
+					2749,
+					2795,
+					2798,
+					2796,
+					2882,
+					2880,
+					2769,
+					2800
 						}), 1, false, 0, false, false);
 			}
-			if (this.type == 390 && Main.rand.Next(100) == 0)
+			if (this.type == 390 && rand.NextBool(100))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2771, 1, false, 0, false, false);
 			}
-			if ((this.type == 116 || this.type == 117 || this.type == 118 || this.type == 119) && (!Main.expertMode || Main.rand.Next(5) == 0))
+			if ((this.type == 116 || this.type == 117 || this.type == 118 || this.type == 119) && (!Main.expertMode || rand.NextBool(5)))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 			}
-			if (this.type == 139 && Main.rand.Next(2) == 0)
+			if (this.type == 139 && rand.NextBool(2))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 			}
 			if (this.type == 63 || this.type == 64 || this.type == 103)
 			{
-				if (Main.rand.Next(100) == 0)
+				if (rand.NextBool(100))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1303, 1, false, -1, false, false);
 				}
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 282, Main.rand.Next(1, 5), false, 0, false, false);
-			}
-			if (this.type == 481 && Main.rand.Next(2) == 0)
-			{
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3094, Main.rand.Next(40, 81), false, 0, false, false);
-			}
-			if (this.type == 481 && Main.rand.Next(20) == 0)
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 282, rand.NextInt(1, 5), false, 0, false, false);
+			}
+			if (this.type == 481 && rand.NextBool(2))
+			{
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3094, rand.NextInt(40, 81), false, 0, false, false);
+			}
+			if (this.type == 481 && rand.NextBool(20))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3187 + Main.rand.Next(3), 1, false, 0, false, false);
 			}
 			if (this.type == 21 || this.type == 44 || this.type == 167 || this.type == 201 || this.type == 202 || this.type == 481 || this.type == 203 || this.type == 322 || this.type == 323 || this.type == 324 || (this.type >= 449 && this.type <= 452))
 			{
-				if (Main.rand.Next(25) == 0)
+				if (rand.NextBool(25))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 118, 1, false, 0, false, false);
 				}
 				else if (this.type == 44)
 				{
-					if (Main.rand.Next(20) == 0)
+					if (rand.NextBool(20))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, Main.rand.Next(410, 412), 1, false, 0, false, false);
 					}
 					else
 					{
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 166, Main.rand.Next(1, 4), false, 0, false, false);
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 166, rand.NextInt(1, 4), false, 0, false, false);
 					}
 				}
 			}
@@ -62643,17 +_,17 @@
 				}
 				else
 				{
-					if (Main.rand.Next(4) == 0)
+					if (rand.NextBool(4))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2430, 1, false, 0, false, false);
 					}
-					if (Main.rand.Next(7) == 0)
+					if (rand.NextBool(7))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2493, 1, false, -1, false, false);
 					}
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, Main.rand.Next(256, 259), 1, false, 0, false, false);
-					Main.rand.Next(2);
-					if (Main.rand.Next(3) == 0)
+					Main.rand.Next(2); // Why is this here?
+					if (rand.NextBool(3))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2585, 1, false, 0, false, false);
 					}
@@ -62669,68 +_,68 @@
 					NetMessage.SendData(7, -1, -1, null, 0, 0f, 0f, 0f, 0, 0, 0);
 				}
 			}
-			if (this.type == 23 && Main.rand.Next(50) == 0)
+			if (this.type == 23 && rand.NextBool(50))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 116, 1, false, 0, false, false);
 			}
-			if (this.type == 24 && Main.rand.Next(250) == 0)
+			if (this.type == 24 && rand.NextBool(250))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 244, 1, false, 0, false, false);
 			}
 			if (this.type == 31 || this.type == 32 || this.type == 34)
 			{
-				if (Main.rand.Next(250) == 0)
+				if (rand.NextBool(250))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 932, 1, false, 0, false, false);
 				}
-				else if (Main.rand.Next(100) == 0)
+				else if (rand.NextBool(100))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3095, 1, false, 0, false, false);
 				}
-				else if (Main.rand.Next(65) == 0)
+				else if (rand.NextBool(65))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 327, 1, false, 0, false, false);
 				}
 				else if (!Main.expertMode)
 				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 154, Main.rand.Next(1, 4), false, 0, false, false);
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 154, rand.NextInt(1, 4), false, 0, false, false);
 				}
 				if (Main.expertMode)
 				{
-					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 154, Main.rand.Next(2, 7), false, 0, false, false);
+					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 154, rand.NextInt(2, 7), false, 0, false, false);
 				}
 			}
 			if (this.type == 26 || this.type == 27 || this.type == 28 || this.type == 29 || this.type == 111)
 			{
-				if (Main.rand.Next(200) == 0)
+				if (rand.NextBool(200))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 160, 1, false, 0, false, false);
 				}
-				else if (Main.rand.Next(2) == 0)
-				{
-					int stack4 = Main.rand.Next(1, 6);
+				else if (rand.NextBool(2))
+				{
+					int stack4 = rand.NextInt(1, 6);
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 161, stack4, false, 0, false, false);
 				}
 			}
-			if (this.type == 175 && Main.rand.Next(100) == 0)
+			if (this.type == 175 && rand.NextBool(100))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1265, 1, false, -1, false, false);
 			}
-			if ((this.type == 42 || (this.type >= 231 && this.type <= 235)) && (Main.expertMode || Main.rand.Next(3) != 0))
+			if ((this.type == 42 || (this.type >= 231 && this.type <= 235)) && (Main.expertMode || rand.NextBoolInverted(3)))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 209, 1, false, 0, false, false);
 			}
-			if (this.type == 204 && (Main.expertMode || Main.rand.Next(2) == 0))
+			if (this.type == 204 && (Main.expertMode || rand.NextBool(2)))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 209, 1, false, 0, false, false);
 			}
-			if (this.type == 43 && (Main.expertMode || Main.rand.Next(2) == 0))
+			if (this.type == 43 && (Main.expertMode || rand.NextBool(2)))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 210, 1, false, 0, false, false);
 			}
 			if (this.type == 65)
 			{
-				if (Main.rand.Next(50) == 0)
+				if (rand.NextBool(50))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 268, 1, false, 0, false, false);
 				}
@@ -62739,7 +_,7 @@
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 319, 1, false, 0, false, false);
 				}
 			}
-			if (this.type == 48 && Main.rand.Next(2) == 0)
+			if (this.type == 48 && rand.NextBool(2))
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 320, 1, false, 0, false, false);
 			}
@@ -62747,7 +_,7 @@
 			{
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3783, 1, false, 0, false, false);
 			}
-			if (this.type == 542 && Main.rand.Next(8) == 0)
+			if (this.type == 542 && rand.NextBool(8))
 			{
 				int num66 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 319, 1, false, 0, false, false);
 				Main.item[num66].color = new Color(189, 148, 96, 255);
@@ -62755,11 +_,11 @@
 			}
 			if (this.type == 543 || this.type == 544)
 			{
-				if (Main.rand.Next(25) == 0)
+				if (rand.NextBool(25))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 527, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(8) == 0)
+				if (rand.NextBool(8))
 				{
 					int num67 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 319, 1, false, 0, false, false);
 					if (this.type == 544)
@@ -62775,11 +_,11 @@
 			}
 			if (this.type == 545)
 			{
-				if (Main.rand.Next(25) == 0)
+				if (rand.NextBool(25))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 528, 1, false, 0, false, false);
 				}
-				if (Main.rand.Next(8) == 0)
+				if (rand.NextBool(8))
 				{
 					int num68 = Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 319, 1, false, 0, false, false);
 					Main.item[num68].color = new Color(158, 113, 164, 255);
@@ -62801,12 +_,12 @@
 					}
 					else
 					{
-						if (Main.rand.Next(7) == 0)
+						if (rand.NextBool(7))
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2106, 1, false, -1, false, false);
 						}
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 549, Main.rand.Next(25, 41), false, 0, false, false);
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1225, Main.rand.Next(15, 31), false, 0, false, false);
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 549, rand.NextInt(25, 41), false, 0, false, false);
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1225, rand.NextInt(15, 31), false, 0, false, false);
 					}
 				}
 				else
@@ -62824,21 +_,21 @@
 			}
 			else if (this.type == 127)
 			{
-				if (Main.rand.Next(7) == 0)
+				if (rand.NextBool(7))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2107, 1, false, -1, false, false);
 				}
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 547, Main.rand.Next(25, 41), false, 0, false, false);
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1225, Main.rand.Next(15, 31), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 547, rand.NextInt(25, 41), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1225, rand.NextInt(15, 31), false, 0, false, false);
 			}
 			else if (this.type == 134)
 			{
-				if (Main.rand.Next(7) == 0)
+				if (rand.NextBool(7))
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2113, 1, false, -1, false, false);
 				}
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 548, Main.rand.Next(25, 41), false, 0, false, false);
-				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1225, Main.rand.Next(15, 31), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 548, rand.NextInt(25, 41), false, 0, false, false);
+				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1225, rand.NextInt(15, 31), false, 0, false, false);
 			}
 			if (this.type == 262)
 			{
@@ -62848,31 +_,31 @@
 				}
 				else
 				{
-					if (Main.rand.Next(7) == 0)
+					if (rand.NextBool(7))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 2109, 1, false, -1, false, false);
 					}
 					if (Main.expertMode)
 					{
-						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1141, Main.rand.Next(2, 4), false, -1, false, false);
+						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1141, rand.NextInt(2, 4), false, -1, false, false);
 					}
 					else
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1141, 1, false, -1, false, false);
 					}
-					if (Main.rand.Next(20) == 0)
+					if (rand.NextBool(20))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1182, 1, false, -1, false, false);
 					}
-					if (Main.rand.Next(50) == 0 || (Main.expertMode && Main.rand.Next(50) == 0))
+					if (rand.NextBool(50) || (Main.expertMode && rand.NextBool(50)))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1305, 1, false, -1, false, false);
 					}
-					if (Main.rand.Next(4) == 0 || Main.expertMode)
+					if (rand.NextBool(4) || Main.expertMode)
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 1157, 1, false, -1, false, false);
 					}
-					if (Main.rand.Next(10) == 0)
+					if (rand.NextBool(10))
 					{
 						Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 3021, 1, false, -1, false, false);
 					}
@@ -62903,7 +_,7 @@
 						if (num73 == 0)
 						{
 							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 758, 1, false, -1, false, false);
-							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 771, Main.rand.Next(50, 150), false, 0, false, false);
+							Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 771, rand.NextInt(50, 150), false, 0, false, false);
 						}
 						else if (num73 == 1)
 						{
@@ -62945,7 +_,7 @@
 					}
 				}
 			}
-			if ((this.boss || this.type == 125 || this.type == 126 || this.type == 491 || this.type == 551 || this.type == 576 || this.type == 577 || this.type == 564 || this.type == 565) && Main.rand.Next(10) == 0)
+			if ((this.boss || this.type == 125 || this.type == 126 || this.type == 491 || this.type == 551 || this.type == 576 || this.type == 577 || this.type == 564 || this.type == 565) && rand.NextBool(10))
 			{
 				if (this.type == 4)
 				{
@@ -63061,7 +_,7 @@
 					NPC.downedMechBossAny = true;
 				}
 				string typeName = this.TypeName;
-				int stack5 = Main.rand.Next(5, 16);
+				int stack5 = rand.NextInt(5, 16);
 				int num74 = 28;
 				if (this.type == 113)
 				{
@@ -63095,8 +_,9 @@
 				{
 					num74 = 499;
 				}
+				NPCLoader.BossLoot(this, ref typeName, ref num74);
 				Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, num74, stack5, false, 0, false, false);
-				int num75 = Main.rand.Next(5) + 5;
+				int num75 = rand.NextInt(5) + 5;
 				for (int num76 = 0; num76 < num75; num76++)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
@@ -63113,7 +_,7 @@
 					{
 						NetMessage.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasBeenDefeated_Plural", new object[]
 								{
-									NetworkText.FromKey("Enemies.TheTwins", new object[0])
+							NetworkText.FromKey("Enemies.TheTwins", new object[0])
 								}), new Color(175, 75, 255), -1);
 					}
 				}
@@ -63127,7 +_,7 @@
 					{
 						NetMessage.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasBeenDefeated_Single", new object[]
 								{
-									NetworkText.FromKey("Enemies.MoonLord", new object[0])
+							NetworkText.FromKey("Enemies.MoonLord", new object[0])
 								}), new Color(175, 75, 255), -1);
 					}
 				}
@@ -63139,7 +_,7 @@
 				{
 					NetMessage.BroadcastChatMessage(NetworkText.FromKey("Announcement.HasBeenDefeated_Single", new object[]
 							{
-								this.GetTypeNetName()
+						this.GetTypeNetName()
 							}), new Color(175, 75, 255), -1);
 				}
 				if (this.type == 113 && Main.netMode != 1)
@@ -63174,19 +_,20 @@
 					NetMessage.BroadcastChatMessage(NetworkText.FromKey(Lang.misc[32].Key, new object[0]), new Color(50, 255, 130), -1);
 				}
 			}
-			if (this.type != 16 && this.type != 81 && this.type != 121 && Main.rand.Next(6) == 0 && this.lifeMax > 1 && this.damage > 0)
+			NPCLoader.NPCLoot(this);
+			if (this.type != 16 && this.type != 81 && this.type != 121 && rand.NextBool(6) && this.lifeMax > 1 && this.damage > 0)
 			{
 				int num77 = (int)Player.FindClosest(this.position, this.width, this.height);
-				if (Main.rand.Next(2) == 0 && Main.player[num77].statMana < Main.player[num77].statManaMax2)
+				if (rand.NextBool(2) && Main.player[num77].statMana < Main.player[num77].statManaMax2)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 184, 1, false, 0, false, false);
 				}
-				else if (Main.rand.Next(2) == 0 && Main.player[num77].statLife < Main.player[num77].statLifeMax2)
+				else if (rand.NextBool(2) && Main.player[num77].statLife < Main.player[num77].statLifeMax2)
 				{
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 58, 1, false, 0, false, false);
 				}
 			}
-			if (this.type != 16 && this.type != 81 && this.type != 121 && Main.rand.Next(2) == 0 && this.lifeMax > 1 && this.damage > 0)
+			if (this.type != 16 && this.type != 81 && this.type != 121 && rand.NextBool(2) && this.lifeMax > 1 && this.damage > 0)
 			{
 				int num78 = (int)Player.FindClosest(this.position, this.width, this.height);
 				if (Main.player[num78].statMana < Main.player[num78].statManaMax2)
@@ -63197,24 +_,24 @@
 			float num79 = this.value;
 			if (this.midas)
 			{
-				num79 *= 1f + (float)Main.rand.Next(10, 50) * 0.01f;
-			}
-			num79 *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
-			if (Main.rand.Next(5) == 0)
-			{
-				num79 *= 1f + (float)Main.rand.Next(5, 11) * 0.01f;
-			}
-			if (Main.rand.Next(10) == 0)
-			{
-				num79 *= 1f + (float)Main.rand.Next(10, 21) * 0.01f;
-			}
-			if (Main.rand.Next(15) == 0)
-			{
-				num79 *= 1f + (float)Main.rand.Next(15, 31) * 0.01f;
-			}
-			if (Main.rand.Next(20) == 0)
-			{
-				num79 *= 1f + (float)Main.rand.Next(20, 41) * 0.01f;
+				num79 *= 1f + (float)rand.NextInt(10, 50) * 0.01f;
+			}
+			num79 *= 1f + (float)rand.NextInt(-20, 21) * 0.01f;
+			if (rand.NextBool(5))
+			{
+				num79 *= 1f + (float)rand.NextInt(5, 11) * 0.01f;
+			}
+			if (rand.NextBool(10))
+			{
+				num79 *= 1f + (float)rand.NextInt(10, 21) * 0.01f;
+			}
+			if (rand.NextBool(15))
+			{
+				num79 *= 1f + (float)rand.NextInt(15, 31) * 0.01f;
+			}
+			if (rand.NextBool(20))
+			{
+				num79 *= 1f + (float)rand.NextInt(20, 41) * 0.01f;
 			}
 			num79 += this.extraValue;
 			while ((int)num79 > 0)
@@ -63222,13 +_,13 @@
 				if (num79 > 1000000f)
 				{
 					int num80 = (int)(num79 / 1000000f);
-					if (num80 > 50 && Main.rand.Next(5) == 0)
-					{
-						num80 /= Main.rand.Next(3) + 1;
-					}
-					if (Main.rand.Next(5) == 0)
-					{
-						num80 /= Main.rand.Next(3) + 1;
+					if (num80 > 50 && rand.NextBool(5))
+					{
+						num80 /= rand.NextInt(3) + 1;
+					}
+					if (rand.NextBool(5))
+					{
+						num80 /= rand.NextInt(3) + 1;
 					}
 					num79 -= (float)(1000000 * num80);
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 74, num80, false, 0, false, false);
@@ -63236,13 +_,13 @@
 				else if (num79 > 10000f)
 				{
 					int num81 = (int)(num79 / 10000f);
-					if (num81 > 50 && Main.rand.Next(5) == 0)
-					{
-						num81 /= Main.rand.Next(3) + 1;
-					}
-					if (Main.rand.Next(5) == 0)
-					{
-						num81 /= Main.rand.Next(3) + 1;
+					if (num81 > 50 && rand.NextBool(5))
+					{
+						num81 /= rand.NextInt(3) + 1;
+					}
+					if (rand.NextBool(5))
+					{
+						num81 /= rand.NextInt(3) + 1;
 					}
 					num79 -= (float)(10000 * num81);
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 73, num81, false, 0, false, false);
@@ -63250,13 +_,13 @@
 				else if (num79 > 100f)
 				{
 					int num82 = (int)(num79 / 100f);
-					if (num82 > 50 && Main.rand.Next(5) == 0)
-					{
-						num82 /= Main.rand.Next(3) + 1;
-					}
-					if (Main.rand.Next(5) == 0)
-					{
-						num82 /= Main.rand.Next(3) + 1;
+					if (num82 > 50 && rand.NextBool(5))
+					{
+						num82 /= rand.NextInt(3) + 1;
+					}
+					if (rand.NextBool(5))
+					{
+						num82 /= rand.NextInt(3) + 1;
 					}
 					num79 -= (float)(100 * num82);
 					Item.NewItem((int)this.position.X, (int)this.position.Y, this.width, this.height, 72, num82, false, 0, false, false);
@@ -63264,13 +_,13 @@
 				else
 				{
 					int num83 = (int)num79;
-					if (num83 > 50 && Main.rand.Next(5) == 0)
-					{
-						num83 /= Main.rand.Next(3) + 1;
-					}
-					if (Main.rand.Next(5) == 0)
-					{
-						num83 /= Main.rand.Next(4) + 1;
+					if (num83 > 50 && rand.NextBool(5))
+					{
+						num83 /= rand.NextInt(3) + 1;
+					}
+					if (rand.NextBool(5))
+					{
+						num83 /= rand.NextInt(4) + 1;
 					}
 					if (num83 < 1)
 					{
@@ -63380,6 +_,7 @@
 			{
 				itemType = 3860;
 			}
+			NPCLoader.BossBag(this, ref itemType);
 			this.DropItemInstanced(this.position, base.Size, itemType, 1, true);
 		}
 
@@ -63558,7 +_,7 @@
 				NetMessage.SendData(71, -1, -1, null, x, (float)y, (float)Type, (float)Style, 0, 0, 0);
 				return;
 			}
-			if (Type >= 0 && Type < 580 && Main.npcCatchable[Type] && NPC.CanReleaseNPCs(who))
+			if (Type >= 0 && Type < NPCLoader.NPCCount && Main.npcCatchable[Type] && NPC.CanReleaseNPCs(who))
 			{
 				if (Type == 148)
 				{
@@ -63731,12 +_,13 @@
 					bool flag9 = false;
 					bool flag10 = false;
 					bool flag11 = false;
-					bool flag12 = NPC.downedPlantBoss && Main.hardMode;
+					bool flag12 = NPC.downedPlantBoss && Main.hardMode; //patch file: flag12
 					if (Main.player[j].active && Main.invasionType > 0 && Main.invasionDelay == 0 && Main.invasionSize > 0 && (double)Main.player[j].position.Y < Main.worldSurface * 16.0 + (double)NPC.sHeight)
 					{
 						int num5 = 3000;
 						if ((double)Main.player[j].position.X > Main.invasionX * 16.0 - (double)num5 && (double)Main.player[j].position.X < Main.invasionX * 16.0 + (double)num5)
 						{
+							//patch file: flag4
 							flag4 = true;
 						}
 						else if (Main.invasionX >= (double)(Main.maxTilesX / 2 - 5) && Main.invasionX <= (double)(Main.maxTilesX / 2 + 5))
@@ -64027,6 +_,7 @@
 						else if (Main.player[j].townNPCs >= 3f)
 						{
 							flag3 = true;
+							//patch file: flag3, flag10
 							if (!Main.expertMode || Main.rand.Next(30) != 0)
 							{
 								flag10 = true;
@@ -64034,6 +_,7 @@
 							NPC.maxSpawns = (int)((double)((float)NPC.maxSpawns) * 0.6);
 						}
 					}
+					NPCLoader.EditSpawnRate(Main.player[j], ref NPC.spawnRate, ref NPC.maxSpawns);
 					int num6 = (int)(Main.player[j].position.X + (float)(Main.player[j].width / 2)) / 16;
 					int num7 = (int)(Main.player[j].position.Y + (float)(Main.player[j].height / 2)) / 16;
 					if (Main.wallHouse[(int)Main.tile[num6, num7].wall])
@@ -64042,6 +_,7 @@
 					}
 					if (Main.tile[num6, num7].wall == 87)
 					{
+						//patch file: flag2
 						flag2 = true;
 					}
 					bool flag14 = false;
@@ -64075,6 +_,8 @@
 							NPC.safeRangeX += (int)((double)(NPC.sWidth / 16) * 0.5 / (double)num8);
 							NPC.safeRangeY += (int)((double)(NPC.sHeight / 16) * 0.5 / (double)num8);
 						}
+						NPCLoader.EditSpawnRange(Main.player[j], ref NPC.spawnRangeX, ref NPC.spawnRangeY,
+							ref NPC.safeRangeX, ref NPC.safeRangeY);
 						int num9 = (int)(Main.player[j].position.X / 16f) - NPC.spawnRangeX;
 						int num10 = (int)(Main.player[j].position.X / 16f) + NPC.spawnRangeX;
 						int num11 = (int)(Main.player[j].position.Y / 16f) - NPC.spawnRangeY;
@@ -64194,6 +_,7 @@
 								}
 								if (num >= num13 && num <= num14)
 								{
+									//patch file(?): flag14
 									flag14 = true;
 									goto IL_1540;
 								}
@@ -64225,6 +_,7 @@
 							}
 						}
 					}
+					NPCSpawnInfo spawnInfo = new NPCSpawnInfo();
 					if (flag13)
 					{
 						if (Main.player[j].ZoneDungeon && (!Main.tileDungeon[(int)Main.tile[num, num2].type] || Main.tile[num, num2 - 1].wall == 0))
@@ -64233,10 +_,12 @@
 						}
 						if (Main.tile[num, num2 - 1].liquid > 0 && Main.tile[num, num2 - 2].liquid > 0 && !Main.tile[num, num2 - 1].lava())
 						{
+							//patch file: flag6
 							if (Main.tile[num, num2 - 1].honey())
 							{
 								flag6 = true;
 							}
+							//patch file: flag5
 							else
 							{
 								flag5 = true;
@@ -64244,12 +_,15 @@
 						}
 						int num25 = (int)Main.player[j].Center.X / 16;
 						int num26 = (int)(Main.player[j].Bottom.Y + 8f) / 16;
+						spawnInfo.playerFloorX = num25;
+						spawnInfo.playerFloorY = num26;
 						if (Main.tile[num, num2].type == 367)
 						{
 							flag8 = true;
 						}
 						else if (Main.tile[num, num2].type == 368)
 						{
+							//patch file: flag7
 							flag7 = true;
 						}
 						else if (Main.tile[num25, num26].type == 367)
@@ -64349,6 +_,7 @@
 										{
 											if (Main.tile[num36, num37].wall == 62)
 											{
+												//patch file: flag9
 												flag9 = true;
 											}
 										}
@@ -64378,6 +_,7 @@
 										{
 											if (WallID.Sets.Conversion.Sandstone[(int)Main.tile[num41, num42].wall] || WallID.Sets.Conversion.HardenedSand[(int)Main.tile[num41, num42].wall])
 											{
+												//patch file: flag11
 												flag11 = true;
 											}
 										}
@@ -64394,8 +_,34 @@
 								}
 							}
 						}
+						spawnInfo.spawnTileX = num;
+						spawnInfo.spawnTileY = num2;
+						spawnInfo.spawnTileType = num3;
+						spawnInfo.player = Main.player[j];
+						spawnInfo.sky = flag;
+						spawnInfo.lihzahrd = flag2;
+						spawnInfo.playerSafe = flag3;
+						spawnInfo.invasion = flag4;
+						spawnInfo.water = flag5;
+						spawnInfo.granite = flag7;
+						spawnInfo.marble = flag8;
+						spawnInfo.spiderCave = flag9;
+						spawnInfo.playerInTown = flag10;
+						spawnInfo.desertCave = flag11;
+						spawnInfo.planteraDefeated = flag12;
+						spawnInfo.safeRangeX = flag14;
 						int num45 = (int)Main.tile[num, num2].type;
 						int num46 = 200;
+						int? spawnChoice = NPCLoader.ChooseSpawn(spawnInfo);
+						if (!spawnChoice.HasValue)
+						{
+							return;
+						}
+						int spawn = spawnChoice.Value;
+						if (spawn != 0)
+						{
+							goto endVanillaSpawn;
+						}
 						if (Main.player[j].ZoneTowerNebula)
 						{
 							bool flag15 = true;
@@ -67439,6 +_,11 @@
 						{
 							num46 = NPC.NewNPC(num * 16 + 8, num2 * 16, 49, 0, 0f, 0f, 0f, 0f, 255);
 						}
+						endVanillaSpawn: //this ugly code is just to minimize the diff file
+						if (spawn != 0)
+						{
+							num46 = NPCLoader.SpawnNPC(spawn, num, num2);
+						}
 						if (Main.npc[num46].type == 1 && Main.rand.Next(180) == 0)
 						{
 							Main.npc[num46].SetDefaults(-4, -1f);
@@ -68252,14 +_,17 @@
 			{
 				num2 = 0;
 			}
-			num = Main.CalculateDamage((int)num, num2);
-			if (crit)
-			{
-				num *= 2.0;
-			}
-			if (this.takenDamageMultiplier > 1f)
-			{
-				num *= (double)this.takenDamageMultiplier;
+			if (NPCLoader.StrikeNPC(this, ref num, num2, ref knockBack, hitDirection, ref crit))
+			{
+				num = Main.CalculateDamage((int)num, num2);
+				if (crit)
+				{
+					num *= 2.0;
+				}
+				if (this.takenDamageMultiplier > 1f)
+				{
+					num *= (double)this.takenDamageMultiplier;
+				}
 			}
 			if ((this.takenDamageMultiplier > 1f || Damage != 9999) && this.lifeMax > 1)
 			{
@@ -68509,6 +_,11 @@
 		}
 
 		public void HitEffect(int hitDirection = 0, double dmg = 10.0)
+		{
+			NPCLoader.HitEffect(this, hitDirection, dmg);
+		}
+
+		public void VanillaHitEffect(int hitDirection = 0, double dmg = 10.0)
 		{
 			if (!this.active)
 			{
@@ -76284,6 +_,11 @@
 			return false;
 		}
 
+		public bool HasBuff(int type)
+		{
+			return FindBuffIndex(type) != -1;
+		}
+
 		public int FindBuffIndex(int type)
 		{
 			if (this.buffImmune[type])
@@ -76322,7 +_,10 @@
 			{
 				if (this.buffType[i] == type)
 				{
-					if (this.buffTime[i] < time)
+					if (BuffLoader.ReApply(type, this, time, i))
+					{
+					}
+					else if (this.buffTime[i] < time)
 					{
 						this.buffTime[i] = time;
 					}
@@ -76667,6 +_,7 @@
 					}
 				}
 				this.UpdateNPC_BuffFlagsReset();
+				NPCLoader.ResetEffects(this);
 				this.UpdateNPC_BuffSetFlags();
 				this.UpdateNPC_SoulDrainDebuff();
 				this.UpdateNPC_BuffClearExpiredBuffs();
@@ -77339,6 +_,7 @@
 						num = 5;
 					}
 				}
+				NPCLoader.UpdateLifeRegen(this, ref num);
 				if (this.lifeRegen <= -240 && num < 2)
 				{
 					num = 2;
@@ -77576,6 +_,7 @@
 					{
 						this.oiled = true;
 					}
+					BuffLoader.Update(this.buffType[i], this, ref i); // todo, move?
 				}
 			}
 		}
@@ -77806,22 +_,30 @@
 						Rectangle hitbox2 = nPC.Hitbox;
 						float num3 = 1f;
 						NPC.GetMeleeCollisionData(hitbox, i, ref num, ref num3, ref hitbox2);
-						if (hitbox.Intersects(hitbox2) && (this.type != 453 || !NPCID.Sets.Skeletons.Contains(nPC.netID)))
+						bool? modCanHit = NPCLoader.CanHitNPC(Main.npc[i], this);
+						if (modCanHit.HasValue && !modCanHit.Value)
+						{
+							continue;
+						}
+						if (hitbox.Intersects(hitbox2) && ((modCanHit.HasValue && modCanHit.Value) || this.type != 453 || !NPCID.Sets.Skeletons.Contains(nPC.netID)))
 						{
 							int num4 = nPC.damage;
-							int num5 = 6;
+							float num5 = 6;
 							int num6 = 1;
 							if (nPC.position.X + (float)(nPC.width / 2) > this.position.X + (float)(this.width / 2))
 							{
 								num6 = -1;
 							}
-							double num7 = this.StrikeNPCNoInteraction(num4, (float)num5, num6, false, false, false);
+							bool crit = false;
+							NPCLoader.ModifyHitNPC(nPC, this, ref num4, ref num5, ref crit);
+							double num7 = this.StrikeNPCNoInteraction(num4, (float)num5, num6, crit, false, false);
 							if (Main.netMode != 0)
 							{
 								NetMessage.SendData(28, -1, -1, null, this.whoAmI, (float)num4, (float)num5, (float)num6, 0, 0, 0);
 							}
 							this.netUpdate = true;
 							this.immune[255] = num2;
+							NPCLoader.OnHitNPC(nPC, this, (int)num7, num5, crit);
 							if (this.dryadWard)
 							{
 								num4 = (int)num7 / 3;
@@ -78585,6 +_,11 @@
 
 		public Color GetAlpha(Color newColor)
 		{
+			Color? modColor = NPCLoader.GetAlpha(this, newColor);
+			if (modColor.HasValue)
+			{
+				return modColor.Value;
+			}
 			float num = (float)(255 - this.alpha) / 255f;
 			int num2 = (int)((float)newColor.R * num);
 			int num3 = (int)((float)newColor.G * num);
@@ -80543,6 +_,7 @@
 			{
 				result = Lang.BartenderChat(this);
 			}
+			NPCLoader.GetChat(this, ref result);
 			return result;
 		}
 

